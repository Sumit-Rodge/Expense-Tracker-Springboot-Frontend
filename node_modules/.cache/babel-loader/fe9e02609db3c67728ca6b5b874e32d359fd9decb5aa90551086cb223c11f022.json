{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.OpCompressedRequest = exports.OpMsgResponse = exports.OpMsgRequest = exports.OpQueryResponse = exports.OpQueryRequest = void 0;\nconst BSON = require(\"../bson\");\nconst error_1 = require(\"../error\");\nconst read_preference_1 = require(\"../read_preference\");\nconst compression_1 = require(\"./wire_protocol/compression\");\nconst constants_1 = require(\"./wire_protocol/constants\");\n// Incrementing request id\nlet _requestId = 0;\n// Query flags\nconst OPTS_TAILABLE_CURSOR = 2;\nconst OPTS_SECONDARY = 4;\nconst OPTS_OPLOG_REPLAY = 8;\nconst OPTS_NO_CURSOR_TIMEOUT = 16;\nconst OPTS_AWAIT_DATA = 32;\nconst OPTS_EXHAUST = 64;\nconst OPTS_PARTIAL = 128;\n// Response flags\nconst CURSOR_NOT_FOUND = 1;\nconst QUERY_FAILURE = 2;\nconst SHARD_CONFIG_STALE = 4;\nconst AWAIT_CAPABLE = 8;\n/**************************************************************\r\n * QUERY\r\n **************************************************************/\n/** @internal */\nclass OpQueryRequest {\n  constructor(databaseName, query, options) {\n    this.databaseName = databaseName;\n    this.query = query;\n    // Basic options needed to be passed in\n    // TODO(NODE-3483): Replace with MongoCommandError\n    const ns = `${databaseName}.$cmd`;\n    if (typeof databaseName !== 'string') {\n      throw new error_1.MongoRuntimeError('Database name must be a string for a query');\n    }\n    // TODO(NODE-3483): Replace with MongoCommandError\n    if (query == null) throw new error_1.MongoRuntimeError('A query document must be specified for query');\n    // Validate that we are not passing 0x00 in the collection name\n    if (ns.indexOf('\\x00') !== -1) {\n      // TODO(NODE-3483): Use MongoNamespace static method\n      throw new error_1.MongoRuntimeError('Namespace cannot contain a null character');\n    }\n    // Basic options\n    this.ns = ns;\n    // Additional options\n    this.numberToSkip = options.numberToSkip || 0;\n    this.numberToReturn = options.numberToReturn || 0;\n    this.returnFieldSelector = options.returnFieldSelector || undefined;\n    this.requestId = options.requestId ?? OpQueryRequest.getRequestId();\n    // special case for pre-3.2 find commands, delete ASAP\n    this.pre32Limit = options.pre32Limit;\n    // Serialization option\n    this.serializeFunctions = typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n    this.ignoreUndefined = typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n    this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n    this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n    this.batchSize = this.numberToReturn;\n    // Flags\n    this.tailable = false;\n    this.secondaryOk = typeof options.secondaryOk === 'boolean' ? options.secondaryOk : false;\n    this.oplogReplay = false;\n    this.noCursorTimeout = false;\n    this.awaitData = false;\n    this.exhaust = false;\n    this.partial = false;\n  }\n  /** Assign next request Id. */\n  incRequestId() {\n    this.requestId = _requestId++;\n  }\n  /** Peek next request Id. */\n  nextRequestId() {\n    return _requestId + 1;\n  }\n  /** Increment then return next request Id. */\n  static getRequestId() {\n    return ++_requestId;\n  }\n  // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n  toBin() {\n    const buffers = [];\n    let projection = null;\n    // Set up the flags\n    let flags = 0;\n    if (this.tailable) {\n      flags |= OPTS_TAILABLE_CURSOR;\n    }\n    if (this.secondaryOk) {\n      flags |= OPTS_SECONDARY;\n    }\n    if (this.oplogReplay) {\n      flags |= OPTS_OPLOG_REPLAY;\n    }\n    if (this.noCursorTimeout) {\n      flags |= OPTS_NO_CURSOR_TIMEOUT;\n    }\n    if (this.awaitData) {\n      flags |= OPTS_AWAIT_DATA;\n    }\n    if (this.exhaust) {\n      flags |= OPTS_EXHAUST;\n    }\n    if (this.partial) {\n      flags |= OPTS_PARTIAL;\n    }\n    // If batchSize is different to this.numberToReturn\n    if (this.batchSize !== this.numberToReturn) this.numberToReturn = this.batchSize;\n    // Allocate write protocol header buffer\n    const header = Buffer.alloc(4 * 4 +\n    // Header\n    4 +\n    // Flags\n    Buffer.byteLength(this.ns) + 1 +\n    // namespace\n    4 +\n    // numberToSkip\n    4 // numberToReturn\n    );\n    // Add header to buffers\n    buffers.push(header);\n    // Serialize the query\n    const query = BSON.serialize(this.query, {\n      checkKeys: this.checkKeys,\n      serializeFunctions: this.serializeFunctions,\n      ignoreUndefined: this.ignoreUndefined\n    });\n    // Add query document\n    buffers.push(query);\n    if (this.returnFieldSelector && Object.keys(this.returnFieldSelector).length > 0) {\n      // Serialize the projection document\n      projection = BSON.serialize(this.returnFieldSelector, {\n        checkKeys: this.checkKeys,\n        serializeFunctions: this.serializeFunctions,\n        ignoreUndefined: this.ignoreUndefined\n      });\n      // Add projection document\n      buffers.push(projection);\n    }\n    // Total message size\n    const totalLength = header.length + query.length + (projection ? projection.length : 0);\n    // Set up the index\n    let index = 4;\n    // Write total document length\n    header[3] = totalLength >> 24 & 0xff;\n    header[2] = totalLength >> 16 & 0xff;\n    header[1] = totalLength >> 8 & 0xff;\n    header[0] = totalLength & 0xff;\n    // Write header information requestId\n    header[index + 3] = this.requestId >> 24 & 0xff;\n    header[index + 2] = this.requestId >> 16 & 0xff;\n    header[index + 1] = this.requestId >> 8 & 0xff;\n    header[index] = this.requestId & 0xff;\n    index = index + 4;\n    // Write header information responseTo\n    header[index + 3] = 0 >> 24 & 0xff;\n    header[index + 2] = 0 >> 16 & 0xff;\n    header[index + 1] = 0 >> 8 & 0xff;\n    header[index] = 0 & 0xff;\n    index = index + 4;\n    // Write header information OP_QUERY\n    header[index + 3] = constants_1.OP_QUERY >> 24 & 0xff;\n    header[index + 2] = constants_1.OP_QUERY >> 16 & 0xff;\n    header[index + 1] = constants_1.OP_QUERY >> 8 & 0xff;\n    header[index] = constants_1.OP_QUERY & 0xff;\n    index = index + 4;\n    // Write header information flags\n    header[index + 3] = flags >> 24 & 0xff;\n    header[index + 2] = flags >> 16 & 0xff;\n    header[index + 1] = flags >> 8 & 0xff;\n    header[index] = flags & 0xff;\n    index = index + 4;\n    // Write collection name\n    index = index + header.write(this.ns, index, 'utf8') + 1;\n    header[index - 1] = 0;\n    // Write header information flags numberToSkip\n    header[index + 3] = this.numberToSkip >> 24 & 0xff;\n    header[index + 2] = this.numberToSkip >> 16 & 0xff;\n    header[index + 1] = this.numberToSkip >> 8 & 0xff;\n    header[index] = this.numberToSkip & 0xff;\n    index = index + 4;\n    // Write header information flags numberToReturn\n    header[index + 3] = this.numberToReturn >> 24 & 0xff;\n    header[index + 2] = this.numberToReturn >> 16 & 0xff;\n    header[index + 1] = this.numberToReturn >> 8 & 0xff;\n    header[index] = this.numberToReturn & 0xff;\n    index = index + 4;\n    // Return the buffers\n    return buffers;\n  }\n}\nexports.OpQueryRequest = OpQueryRequest;\n/** @internal */\nclass OpQueryResponse {\n  constructor(message, msgHeader, msgBody, opts) {\n    this.documents = new Array(0);\n    /** moreToCome is an OP_MSG only concept */\n    this.moreToCome = false;\n    this.parsed = false;\n    this.raw = message;\n    this.data = msgBody;\n    this.opts = opts ?? {\n      useBigInt64: false,\n      promoteLongs: true,\n      promoteValues: true,\n      promoteBuffers: false,\n      bsonRegExp: false\n    };\n    // Read the message header\n    this.length = msgHeader.length;\n    this.requestId = msgHeader.requestId;\n    this.responseTo = msgHeader.responseTo;\n    this.opCode = msgHeader.opCode;\n    this.fromCompressed = msgHeader.fromCompressed;\n    // Flag values\n    this.useBigInt64 = typeof this.opts.useBigInt64 === 'boolean' ? this.opts.useBigInt64 : false;\n    this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n    this.promoteValues = typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n    this.promoteBuffers = typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n    this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n  }\n  isParsed() {\n    return this.parsed;\n  }\n  parse(options) {\n    // Don't parse again if not needed\n    if (this.parsed) return;\n    options = options ?? {};\n    // Allow the return of raw documents instead of parsing\n    const raw = options.raw || false;\n    const documentsReturnedIn = options.documentsReturnedIn || null;\n    const useBigInt64 = options.useBigInt64 ?? this.opts.useBigInt64;\n    const promoteLongs = options.promoteLongs ?? this.opts.promoteLongs;\n    const promoteValues = options.promoteValues ?? this.opts.promoteValues;\n    const promoteBuffers = options.promoteBuffers ?? this.opts.promoteBuffers;\n    const bsonRegExp = options.bsonRegExp ?? this.opts.bsonRegExp;\n    let bsonSize;\n    // Set up the options\n    const _options = {\n      useBigInt64,\n      promoteLongs,\n      promoteValues,\n      promoteBuffers,\n      bsonRegExp\n    };\n    // Position within OP_REPLY at which documents start\n    // (See https://www.mongodb.com/docs/manual/reference/mongodb-wire-protocol/#wire-op-reply)\n    this.index = 20;\n    // Read the message body\n    this.responseFlags = this.data.readInt32LE(0);\n    this.cursorId = new BSON.Long(this.data.readInt32LE(4), this.data.readInt32LE(8));\n    this.startingFrom = this.data.readInt32LE(12);\n    this.numberReturned = this.data.readInt32LE(16);\n    // Preallocate document array\n    this.documents = new Array(this.numberReturned);\n    this.cursorNotFound = (this.responseFlags & CURSOR_NOT_FOUND) !== 0;\n    this.queryFailure = (this.responseFlags & QUERY_FAILURE) !== 0;\n    this.shardConfigStale = (this.responseFlags & SHARD_CONFIG_STALE) !== 0;\n    this.awaitCapable = (this.responseFlags & AWAIT_CAPABLE) !== 0;\n    // Parse Body\n    for (let i = 0; i < this.numberReturned; i++) {\n      bsonSize = this.data[this.index] | this.data[this.index + 1] << 8 | this.data[this.index + 2] << 16 | this.data[this.index + 3] << 24;\n      // If we have raw results specified slice the return document\n      if (raw) {\n        this.documents[i] = this.data.slice(this.index, this.index + bsonSize);\n      } else {\n        this.documents[i] = BSON.deserialize(this.data.slice(this.index, this.index + bsonSize), _options);\n      }\n      // Adjust the index\n      this.index = this.index + bsonSize;\n    }\n    if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\n      const fieldsAsRaw = {};\n      fieldsAsRaw[documentsReturnedIn] = true;\n      _options.fieldsAsRaw = fieldsAsRaw;\n      const doc = BSON.deserialize(this.documents[0], _options);\n      this.documents = [doc];\n    }\n    // Set parsed\n    this.parsed = true;\n  }\n}\nexports.OpQueryResponse = OpQueryResponse;\n// Implementation of OP_MSG spec:\n// https://github.com/mongodb/specifications/blob/master/source/message/OP_MSG.rst\n//\n// struct Section {\n//   uint8 payloadType;\n//   union payload {\n//       document  document; // payloadType == 0\n//       struct sequence { // payloadType == 1\n//           int32      size;\n//           cstring    identifier;\n//           document*  documents;\n//       };\n//   };\n// };\n// struct OP_MSG {\n//   struct MsgHeader {\n//       int32  messageLength;\n//       int32  requestID;\n//       int32  responseTo;\n//       int32  opCode = 2013;\n//   };\n//   uint32      flagBits;\n//   Section+    sections;\n//   [uint32     checksum;]\n// };\n// Msg Flags\nconst OPTS_CHECKSUM_PRESENT = 1;\nconst OPTS_MORE_TO_COME = 2;\nconst OPTS_EXHAUST_ALLOWED = 1 << 16;\n/** @internal */\nclass OpMsgRequest {\n  constructor(databaseName, command, options) {\n    this.databaseName = databaseName;\n    this.command = command;\n    this.options = options;\n    // Basic options needed to be passed in\n    if (command == null) throw new error_1.MongoInvalidArgumentError('Query document must be specified for query');\n    // Basic options\n    this.command.$db = databaseName;\n    if (options.readPreference && options.readPreference.mode !== read_preference_1.ReadPreference.PRIMARY) {\n      this.command.$readPreference = options.readPreference.toJSON();\n    }\n    // Ensure empty options\n    this.options = options ?? {};\n    // Additional options\n    this.requestId = options.requestId ? options.requestId : OpMsgRequest.getRequestId();\n    // Serialization option\n    this.serializeFunctions = typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n    this.ignoreUndefined = typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n    this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n    this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n    // flags\n    this.checksumPresent = false;\n    this.moreToCome = options.moreToCome || false;\n    this.exhaustAllowed = typeof options.exhaustAllowed === 'boolean' ? options.exhaustAllowed : false;\n  }\n  toBin() {\n    const buffers = [];\n    let flags = 0;\n    if (this.checksumPresent) {\n      flags |= OPTS_CHECKSUM_PRESENT;\n    }\n    if (this.moreToCome) {\n      flags |= OPTS_MORE_TO_COME;\n    }\n    if (this.exhaustAllowed) {\n      flags |= OPTS_EXHAUST_ALLOWED;\n    }\n    const header = Buffer.alloc(4 * 4 +\n    // Header\n    4 // Flags\n    );\n    buffers.push(header);\n    let totalLength = header.length;\n    const command = this.command;\n    totalLength += this.makeDocumentSegment(buffers, command);\n    header.writeInt32LE(totalLength, 0); // messageLength\n    header.writeInt32LE(this.requestId, 4); // requestID\n    header.writeInt32LE(0, 8); // responseTo\n    header.writeInt32LE(constants_1.OP_MSG, 12); // opCode\n    header.writeUInt32LE(flags, 16); // flags\n    return buffers;\n  }\n  makeDocumentSegment(buffers, document) {\n    const payloadTypeBuffer = Buffer.alloc(1);\n    payloadTypeBuffer[0] = 0;\n    const documentBuffer = this.serializeBson(document);\n    buffers.push(payloadTypeBuffer);\n    buffers.push(documentBuffer);\n    return payloadTypeBuffer.length + documentBuffer.length;\n  }\n  serializeBson(document) {\n    return BSON.serialize(document, {\n      checkKeys: this.checkKeys,\n      serializeFunctions: this.serializeFunctions,\n      ignoreUndefined: this.ignoreUndefined\n    });\n  }\n  static getRequestId() {\n    _requestId = _requestId + 1 & 0x7fffffff;\n    return _requestId;\n  }\n}\nexports.OpMsgRequest = OpMsgRequest;\n/** @internal */\nclass OpMsgResponse {\n  constructor(message, msgHeader, msgBody, opts) {\n    this.parsed = false;\n    this.raw = message;\n    this.data = msgBody;\n    this.opts = opts ?? {\n      useBigInt64: false,\n      promoteLongs: true,\n      promoteValues: true,\n      promoteBuffers: false,\n      bsonRegExp: false\n    };\n    // Read the message header\n    this.length = msgHeader.length;\n    this.requestId = msgHeader.requestId;\n    this.responseTo = msgHeader.responseTo;\n    this.opCode = msgHeader.opCode;\n    this.fromCompressed = msgHeader.fromCompressed;\n    // Read response flags\n    this.responseFlags = msgBody.readInt32LE(0);\n    this.checksumPresent = (this.responseFlags & OPTS_CHECKSUM_PRESENT) !== 0;\n    this.moreToCome = (this.responseFlags & OPTS_MORE_TO_COME) !== 0;\n    this.exhaustAllowed = (this.responseFlags & OPTS_EXHAUST_ALLOWED) !== 0;\n    this.useBigInt64 = typeof this.opts.useBigInt64 === 'boolean' ? this.opts.useBigInt64 : false;\n    this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n    this.promoteValues = typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n    this.promoteBuffers = typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n    this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n    this.documents = [];\n  }\n  isParsed() {\n    return this.parsed;\n  }\n  parse(options) {\n    // Don't parse again if not needed\n    if (this.parsed) return;\n    options = options ?? {};\n    this.index = 4;\n    // Allow the return of raw documents instead of parsing\n    const raw = options.raw || false;\n    const documentsReturnedIn = options.documentsReturnedIn || null;\n    const useBigInt64 = options.useBigInt64 ?? this.opts.useBigInt64;\n    const promoteLongs = options.promoteLongs ?? this.opts.promoteLongs;\n    const promoteValues = options.promoteValues ?? this.opts.promoteValues;\n    const promoteBuffers = options.promoteBuffers ?? this.opts.promoteBuffers;\n    const bsonRegExp = options.bsonRegExp ?? this.opts.bsonRegExp;\n    const validation = this.parseBsonSerializationOptions(options);\n    // Set up the options\n    const bsonOptions = {\n      useBigInt64,\n      promoteLongs,\n      promoteValues,\n      promoteBuffers,\n      bsonRegExp,\n      validation\n      // Due to the strictness of the BSON libraries validation option we need this cast\n    };\n    while (this.index < this.data.length) {\n      const payloadType = this.data.readUInt8(this.index++);\n      if (payloadType === 0) {\n        const bsonSize = this.data.readUInt32LE(this.index);\n        const bin = this.data.slice(this.index, this.index + bsonSize);\n        this.documents.push(raw ? bin : BSON.deserialize(bin, bsonOptions));\n        this.index += bsonSize;\n      } else if (payloadType === 1) {\n        // It was decided that no driver makes use of payload type 1\n        // TODO(NODE-3483): Replace with MongoDeprecationError\n        throw new error_1.MongoRuntimeError('OP_MSG Payload Type 1 detected unsupported protocol');\n      }\n    }\n    if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\n      const fieldsAsRaw = {};\n      fieldsAsRaw[documentsReturnedIn] = true;\n      bsonOptions.fieldsAsRaw = fieldsAsRaw;\n      const doc = BSON.deserialize(this.documents[0], bsonOptions);\n      this.documents = [doc];\n    }\n    this.parsed = true;\n  }\n  parseBsonSerializationOptions({\n    enableUtf8Validation\n  }) {\n    if (enableUtf8Validation === false) {\n      return {\n        utf8: false\n      };\n    }\n    return {\n      utf8: {\n        writeErrors: false\n      }\n    };\n  }\n}\nexports.OpMsgResponse = OpMsgResponse;\nconst MESSAGE_HEADER_SIZE = 16;\nconst COMPRESSION_DETAILS_SIZE = 9; // originalOpcode + uncompressedSize, compressorID\n/**\r\n * @internal\r\n *\r\n * An OP_COMPRESSED request wraps either an OP_QUERY or OP_MSG message.\r\n */\nclass OpCompressedRequest {\n  constructor(command, options) {\n    this.command = command;\n    this.options = options;\n  }\n  // Return whether a command contains an uncompressible command term\n  // Will return true if command contains no uncompressible command terms\n  static canCompress(command) {\n    const commandDoc = command instanceof OpMsgRequest ? command.command : command.query;\n    const commandName = Object.keys(commandDoc)[0];\n    return !compression_1.uncompressibleCommands.has(commandName);\n  }\n  async toBin() {\n    const concatenatedOriginalCommandBuffer = Buffer.concat(this.command.toBin());\n    // otherwise, compress the message\n    const messageToBeCompressed = concatenatedOriginalCommandBuffer.slice(MESSAGE_HEADER_SIZE);\n    // Extract information needed for OP_COMPRESSED from the uncompressed message\n    const originalCommandOpCode = concatenatedOriginalCommandBuffer.readInt32LE(12);\n    // Compress the message body\n    const compressedMessage = await (0, compression_1.compress)(this.options, messageToBeCompressed);\n    // Create the msgHeader of OP_COMPRESSED\n    const msgHeader = Buffer.alloc(MESSAGE_HEADER_SIZE);\n    msgHeader.writeInt32LE(MESSAGE_HEADER_SIZE + COMPRESSION_DETAILS_SIZE + compressedMessage.length, 0); // messageLength\n    msgHeader.writeInt32LE(this.command.requestId, 4); // requestID\n    msgHeader.writeInt32LE(0, 8); // responseTo (zero)\n    msgHeader.writeInt32LE(constants_1.OP_COMPRESSED, 12); // opCode\n    // Create the compression details of OP_COMPRESSED\n    const compressionDetails = Buffer.alloc(COMPRESSION_DETAILS_SIZE);\n    compressionDetails.writeInt32LE(originalCommandOpCode, 0); // originalOpcode\n    compressionDetails.writeInt32LE(messageToBeCompressed.length, 4); // Size of the uncompressed compressedMessage, excluding the MsgHeader\n    compressionDetails.writeUInt8(compression_1.Compressor[this.options.agreedCompressor], 8); // compressorID\n    return [msgHeader, compressionDetails, compressedMessage];\n  }\n}\nexports.OpCompressedRequest = OpCompressedRequest;","map":{"version":3,"names":["BSON","require","error_1","read_preference_1","compression_1","constants_1","_requestId","OPTS_TAILABLE_CURSOR","OPTS_SECONDARY","OPTS_OPLOG_REPLAY","OPTS_NO_CURSOR_TIMEOUT","OPTS_AWAIT_DATA","OPTS_EXHAUST","OPTS_PARTIAL","CURSOR_NOT_FOUND","QUERY_FAILURE","SHARD_CONFIG_STALE","AWAIT_CAPABLE","OpQueryRequest","constructor","databaseName","query","options","ns","MongoRuntimeError","indexOf","numberToSkip","numberToReturn","returnFieldSelector","undefined","requestId","getRequestId","pre32Limit","serializeFunctions","ignoreUndefined","maxBsonSize","checkKeys","batchSize","tailable","secondaryOk","oplogReplay","noCursorTimeout","awaitData","exhaust","partial","incRequestId","nextRequestId","toBin","buffers","projection","flags","header","Buffer","alloc","byteLength","push","serialize","Object","keys","length","totalLength","index","OP_QUERY","write","exports","OpQueryResponse","message","msgHeader","msgBody","opts","documents","Array","moreToCome","parsed","raw","data","useBigInt64","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","responseTo","opCode","fromCompressed","isParsed","parse","documentsReturnedIn","bsonSize","_options","responseFlags","readInt32LE","cursorId","Long","startingFrom","numberReturned","cursorNotFound","queryFailure","shardConfigStale","awaitCapable","i","slice","deserialize","fieldsAsRaw","doc","OPTS_CHECKSUM_PRESENT","OPTS_MORE_TO_COME","OPTS_EXHAUST_ALLOWED","OpMsgRequest","command","MongoInvalidArgumentError","$db","readPreference","mode","ReadPreference","PRIMARY","$readPreference","toJSON","checksumPresent","exhaustAllowed","makeDocumentSegment","writeInt32LE","OP_MSG","writeUInt32LE","document","payloadTypeBuffer","documentBuffer","serializeBson","OpMsgResponse","validation","parseBsonSerializationOptions","bsonOptions","payloadType","readUInt8","readUInt32LE","bin","enableUtf8Validation","utf8","writeErrors","MESSAGE_HEADER_SIZE","COMPRESSION_DETAILS_SIZE","OpCompressedRequest","canCompress","commandDoc","commandName","uncompressibleCommands","has","concatenatedOriginalCommandBuffer","concat","messageToBeCompressed","originalCommandOpCode","compressedMessage","compress","OP_COMPRESSED","compressionDetails","writeUInt8","Compressor","agreedCompressor"],"sources":["C:\\Users\\sumit\\Desktop\\Final project\\Expense-Tracker-Springboot-Frontend\\node_modules\\mongodb\\src\\cmap\\commands.ts"],"sourcesContent":["import type { BSONSerializeOptions, Document, Long } from '../bson';\r\nimport * as BSON from '../bson';\r\nimport { MongoInvalidArgumentError, MongoRuntimeError } from '../error';\r\nimport { ReadPreference } from '../read_preference';\r\nimport type { ClientSession } from '../sessions';\r\nimport type { CommandOptions } from './connection';\r\nimport {\r\n  compress,\r\n  Compressor,\r\n  type CompressorName,\r\n  uncompressibleCommands\r\n} from './wire_protocol/compression';\r\nimport { OP_COMPRESSED, OP_MSG, OP_QUERY } from './wire_protocol/constants';\r\n\r\n// Incrementing request id\r\nlet _requestId = 0;\r\n\r\n// Query flags\r\nconst OPTS_TAILABLE_CURSOR = 2;\r\nconst OPTS_SECONDARY = 4;\r\nconst OPTS_OPLOG_REPLAY = 8;\r\nconst OPTS_NO_CURSOR_TIMEOUT = 16;\r\nconst OPTS_AWAIT_DATA = 32;\r\nconst OPTS_EXHAUST = 64;\r\nconst OPTS_PARTIAL = 128;\r\n\r\n// Response flags\r\nconst CURSOR_NOT_FOUND = 1;\r\nconst QUERY_FAILURE = 2;\r\nconst SHARD_CONFIG_STALE = 4;\r\nconst AWAIT_CAPABLE = 8;\r\n\r\n/** @internal */\r\nexport type WriteProtocolMessageType = OpQueryRequest | OpMsgRequest;\r\n\r\n/** @internal */\r\nexport interface OpQueryOptions extends CommandOptions {\r\n  socketTimeoutMS?: number;\r\n  session?: ClientSession;\r\n  documentsReturnedIn?: string;\r\n  numberToSkip?: number;\r\n  numberToReturn?: number;\r\n  returnFieldSelector?: Document;\r\n  pre32Limit?: number;\r\n  serializeFunctions?: boolean;\r\n  ignoreUndefined?: boolean;\r\n  maxBsonSize?: number;\r\n  checkKeys?: boolean;\r\n  secondaryOk?: boolean;\r\n\r\n  requestId?: number;\r\n  moreToCome?: boolean;\r\n  exhaustAllowed?: boolean;\r\n  readPreference?: ReadPreference;\r\n}\r\n\r\n/**************************************************************\r\n * QUERY\r\n **************************************************************/\r\n/** @internal */\r\nexport class OpQueryRequest {\r\n  ns: string;\r\n  numberToSkip: number;\r\n  numberToReturn: number;\r\n  returnFieldSelector?: Document;\r\n  requestId: number;\r\n  pre32Limit?: number;\r\n  serializeFunctions: boolean;\r\n  ignoreUndefined: boolean;\r\n  maxBsonSize: number;\r\n  checkKeys: boolean;\r\n  batchSize: number;\r\n  tailable: boolean;\r\n  secondaryOk: boolean;\r\n  oplogReplay: boolean;\r\n  noCursorTimeout: boolean;\r\n  awaitData: boolean;\r\n  exhaust: boolean;\r\n  partial: boolean;\r\n  documentsReturnedIn?: string;\r\n\r\n  constructor(public databaseName: string, public query: Document, options: OpQueryOptions) {\r\n    // Basic options needed to be passed in\r\n    // TODO(NODE-3483): Replace with MongoCommandError\r\n    const ns = `${databaseName}.$cmd`;\r\n    if (typeof databaseName !== 'string') {\r\n      throw new MongoRuntimeError('Database name must be a string for a query');\r\n    }\r\n    // TODO(NODE-3483): Replace with MongoCommandError\r\n    if (query == null) throw new MongoRuntimeError('A query document must be specified for query');\r\n\r\n    // Validate that we are not passing 0x00 in the collection name\r\n    if (ns.indexOf('\\x00') !== -1) {\r\n      // TODO(NODE-3483): Use MongoNamespace static method\r\n      throw new MongoRuntimeError('Namespace cannot contain a null character');\r\n    }\r\n\r\n    // Basic options\r\n    this.ns = ns;\r\n\r\n    // Additional options\r\n    this.numberToSkip = options.numberToSkip || 0;\r\n    this.numberToReturn = options.numberToReturn || 0;\r\n    this.returnFieldSelector = options.returnFieldSelector || undefined;\r\n    this.requestId = options.requestId ?? OpQueryRequest.getRequestId();\r\n\r\n    // special case for pre-3.2 find commands, delete ASAP\r\n    this.pre32Limit = options.pre32Limit;\r\n\r\n    // Serialization option\r\n    this.serializeFunctions =\r\n      typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\r\n    this.ignoreUndefined =\r\n      typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\r\n    this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\r\n    this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\r\n    this.batchSize = this.numberToReturn;\r\n\r\n    // Flags\r\n    this.tailable = false;\r\n    this.secondaryOk = typeof options.secondaryOk === 'boolean' ? options.secondaryOk : false;\r\n    this.oplogReplay = false;\r\n    this.noCursorTimeout = false;\r\n    this.awaitData = false;\r\n    this.exhaust = false;\r\n    this.partial = false;\r\n  }\r\n\r\n  /** Assign next request Id. */\r\n  incRequestId(): void {\r\n    this.requestId = _requestId++;\r\n  }\r\n\r\n  /** Peek next request Id. */\r\n  nextRequestId(): number {\r\n    return _requestId + 1;\r\n  }\r\n\r\n  /** Increment then return next request Id. */\r\n  static getRequestId(): number {\r\n    return ++_requestId;\r\n  }\r\n\r\n  // Uses a single allocated buffer for the process, avoiding multiple memory allocations\r\n  toBin(): Uint8Array[] {\r\n    const buffers = [];\r\n    let projection = null;\r\n\r\n    // Set up the flags\r\n    let flags = 0;\r\n    if (this.tailable) {\r\n      flags |= OPTS_TAILABLE_CURSOR;\r\n    }\r\n\r\n    if (this.secondaryOk) {\r\n      flags |= OPTS_SECONDARY;\r\n    }\r\n\r\n    if (this.oplogReplay) {\r\n      flags |= OPTS_OPLOG_REPLAY;\r\n    }\r\n\r\n    if (this.noCursorTimeout) {\r\n      flags |= OPTS_NO_CURSOR_TIMEOUT;\r\n    }\r\n\r\n    if (this.awaitData) {\r\n      flags |= OPTS_AWAIT_DATA;\r\n    }\r\n\r\n    if (this.exhaust) {\r\n      flags |= OPTS_EXHAUST;\r\n    }\r\n\r\n    if (this.partial) {\r\n      flags |= OPTS_PARTIAL;\r\n    }\r\n\r\n    // If batchSize is different to this.numberToReturn\r\n    if (this.batchSize !== this.numberToReturn) this.numberToReturn = this.batchSize;\r\n\r\n    // Allocate write protocol header buffer\r\n    const header = Buffer.alloc(\r\n      4 * 4 + // Header\r\n        4 + // Flags\r\n        Buffer.byteLength(this.ns) +\r\n        1 + // namespace\r\n        4 + // numberToSkip\r\n        4 // numberToReturn\r\n    );\r\n\r\n    // Add header to buffers\r\n    buffers.push(header);\r\n\r\n    // Serialize the query\r\n    const query = BSON.serialize(this.query, {\r\n      checkKeys: this.checkKeys,\r\n      serializeFunctions: this.serializeFunctions,\r\n      ignoreUndefined: this.ignoreUndefined\r\n    });\r\n\r\n    // Add query document\r\n    buffers.push(query);\r\n\r\n    if (this.returnFieldSelector && Object.keys(this.returnFieldSelector).length > 0) {\r\n      // Serialize the projection document\r\n      projection = BSON.serialize(this.returnFieldSelector, {\r\n        checkKeys: this.checkKeys,\r\n        serializeFunctions: this.serializeFunctions,\r\n        ignoreUndefined: this.ignoreUndefined\r\n      });\r\n      // Add projection document\r\n      buffers.push(projection);\r\n    }\r\n\r\n    // Total message size\r\n    const totalLength = header.length + query.length + (projection ? projection.length : 0);\r\n\r\n    // Set up the index\r\n    let index = 4;\r\n\r\n    // Write total document length\r\n    header[3] = (totalLength >> 24) & 0xff;\r\n    header[2] = (totalLength >> 16) & 0xff;\r\n    header[1] = (totalLength >> 8) & 0xff;\r\n    header[0] = totalLength & 0xff;\r\n\r\n    // Write header information requestId\r\n    header[index + 3] = (this.requestId >> 24) & 0xff;\r\n    header[index + 2] = (this.requestId >> 16) & 0xff;\r\n    header[index + 1] = (this.requestId >> 8) & 0xff;\r\n    header[index] = this.requestId & 0xff;\r\n    index = index + 4;\r\n\r\n    // Write header information responseTo\r\n    header[index + 3] = (0 >> 24) & 0xff;\r\n    header[index + 2] = (0 >> 16) & 0xff;\r\n    header[index + 1] = (0 >> 8) & 0xff;\r\n    header[index] = 0 & 0xff;\r\n    index = index + 4;\r\n\r\n    // Write header information OP_QUERY\r\n    header[index + 3] = (OP_QUERY >> 24) & 0xff;\r\n    header[index + 2] = (OP_QUERY >> 16) & 0xff;\r\n    header[index + 1] = (OP_QUERY >> 8) & 0xff;\r\n    header[index] = OP_QUERY & 0xff;\r\n    index = index + 4;\r\n\r\n    // Write header information flags\r\n    header[index + 3] = (flags >> 24) & 0xff;\r\n    header[index + 2] = (flags >> 16) & 0xff;\r\n    header[index + 1] = (flags >> 8) & 0xff;\r\n    header[index] = flags & 0xff;\r\n    index = index + 4;\r\n\r\n    // Write collection name\r\n    index = index + header.write(this.ns, index, 'utf8') + 1;\r\n    header[index - 1] = 0;\r\n\r\n    // Write header information flags numberToSkip\r\n    header[index + 3] = (this.numberToSkip >> 24) & 0xff;\r\n    header[index + 2] = (this.numberToSkip >> 16) & 0xff;\r\n    header[index + 1] = (this.numberToSkip >> 8) & 0xff;\r\n    header[index] = this.numberToSkip & 0xff;\r\n    index = index + 4;\r\n\r\n    // Write header information flags numberToReturn\r\n    header[index + 3] = (this.numberToReturn >> 24) & 0xff;\r\n    header[index + 2] = (this.numberToReturn >> 16) & 0xff;\r\n    header[index + 1] = (this.numberToReturn >> 8) & 0xff;\r\n    header[index] = this.numberToReturn & 0xff;\r\n    index = index + 4;\r\n\r\n    // Return the buffers\r\n    return buffers;\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport interface MessageHeader {\r\n  length: number;\r\n  requestId: number;\r\n  responseTo: number;\r\n  opCode: number;\r\n  fromCompressed?: boolean;\r\n}\r\n\r\n/** @internal */\r\nexport interface OpResponseOptions extends BSONSerializeOptions {\r\n  documentsReturnedIn?: string | null;\r\n}\r\n\r\n/** @internal */\r\nexport class OpQueryResponse {\r\n  parsed: boolean;\r\n  raw: Buffer;\r\n  data: Buffer;\r\n  opts: OpResponseOptions;\r\n  length: number;\r\n  requestId: number;\r\n  responseTo: number;\r\n  opCode: number;\r\n  fromCompressed?: boolean;\r\n  responseFlags?: number;\r\n  cursorId?: Long;\r\n  startingFrom?: number;\r\n  numberReturned?: number;\r\n  documents: (Document | Buffer)[] = new Array(0);\r\n  cursorNotFound?: boolean;\r\n  queryFailure?: boolean;\r\n  shardConfigStale?: boolean;\r\n  awaitCapable?: boolean;\r\n  useBigInt64: boolean;\r\n  promoteLongs: boolean;\r\n  promoteValues: boolean;\r\n  promoteBuffers: boolean;\r\n  bsonRegExp?: boolean;\r\n  index?: number;\r\n\r\n  /** moreToCome is an OP_MSG only concept */\r\n  moreToCome = false;\r\n\r\n  constructor(\r\n    message: Buffer,\r\n    msgHeader: MessageHeader,\r\n    msgBody: Buffer,\r\n    opts?: OpResponseOptions\r\n  ) {\r\n    this.parsed = false;\r\n    this.raw = message;\r\n    this.data = msgBody;\r\n    this.opts = opts ?? {\r\n      useBigInt64: false,\r\n      promoteLongs: true,\r\n      promoteValues: true,\r\n      promoteBuffers: false,\r\n      bsonRegExp: false\r\n    };\r\n\r\n    // Read the message header\r\n    this.length = msgHeader.length;\r\n    this.requestId = msgHeader.requestId;\r\n    this.responseTo = msgHeader.responseTo;\r\n    this.opCode = msgHeader.opCode;\r\n    this.fromCompressed = msgHeader.fromCompressed;\r\n\r\n    // Flag values\r\n    this.useBigInt64 = typeof this.opts.useBigInt64 === 'boolean' ? this.opts.useBigInt64 : false;\r\n    this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\r\n    this.promoteValues =\r\n      typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\r\n    this.promoteBuffers =\r\n      typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\r\n    this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\r\n  }\r\n\r\n  isParsed(): boolean {\r\n    return this.parsed;\r\n  }\r\n\r\n  parse(options: OpResponseOptions): void {\r\n    // Don't parse again if not needed\r\n    if (this.parsed) return;\r\n    options = options ?? {};\r\n\r\n    // Allow the return of raw documents instead of parsing\r\n    const raw = options.raw || false;\r\n    const documentsReturnedIn = options.documentsReturnedIn || null;\r\n    const useBigInt64 = options.useBigInt64 ?? this.opts.useBigInt64;\r\n    const promoteLongs = options.promoteLongs ?? this.opts.promoteLongs;\r\n    const promoteValues = options.promoteValues ?? this.opts.promoteValues;\r\n    const promoteBuffers = options.promoteBuffers ?? this.opts.promoteBuffers;\r\n    const bsonRegExp = options.bsonRegExp ?? this.opts.bsonRegExp;\r\n    let bsonSize;\r\n\r\n    // Set up the options\r\n    const _options: BSONSerializeOptions = {\r\n      useBigInt64,\r\n      promoteLongs,\r\n      promoteValues,\r\n      promoteBuffers,\r\n      bsonRegExp\r\n    };\r\n\r\n    // Position within OP_REPLY at which documents start\r\n    // (See https://www.mongodb.com/docs/manual/reference/mongodb-wire-protocol/#wire-op-reply)\r\n    this.index = 20;\r\n\r\n    // Read the message body\r\n    this.responseFlags = this.data.readInt32LE(0);\r\n    this.cursorId = new BSON.Long(this.data.readInt32LE(4), this.data.readInt32LE(8));\r\n    this.startingFrom = this.data.readInt32LE(12);\r\n    this.numberReturned = this.data.readInt32LE(16);\r\n\r\n    // Preallocate document array\r\n    this.documents = new Array(this.numberReturned);\r\n\r\n    this.cursorNotFound = (this.responseFlags & CURSOR_NOT_FOUND) !== 0;\r\n    this.queryFailure = (this.responseFlags & QUERY_FAILURE) !== 0;\r\n    this.shardConfigStale = (this.responseFlags & SHARD_CONFIG_STALE) !== 0;\r\n    this.awaitCapable = (this.responseFlags & AWAIT_CAPABLE) !== 0;\r\n\r\n    // Parse Body\r\n    for (let i = 0; i < this.numberReturned; i++) {\r\n      bsonSize =\r\n        this.data[this.index] |\r\n        (this.data[this.index + 1] << 8) |\r\n        (this.data[this.index + 2] << 16) |\r\n        (this.data[this.index + 3] << 24);\r\n\r\n      // If we have raw results specified slice the return document\r\n      if (raw) {\r\n        this.documents[i] = this.data.slice(this.index, this.index + bsonSize);\r\n      } else {\r\n        this.documents[i] = BSON.deserialize(\r\n          this.data.slice(this.index, this.index + bsonSize),\r\n          _options\r\n        );\r\n      }\r\n\r\n      // Adjust the index\r\n      this.index = this.index + bsonSize;\r\n    }\r\n\r\n    if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\r\n      const fieldsAsRaw: Document = {};\r\n      fieldsAsRaw[documentsReturnedIn] = true;\r\n      _options.fieldsAsRaw = fieldsAsRaw;\r\n\r\n      const doc = BSON.deserialize(this.documents[0] as Buffer, _options);\r\n      this.documents = [doc];\r\n    }\r\n\r\n    // Set parsed\r\n    this.parsed = true;\r\n  }\r\n}\r\n\r\n// Implementation of OP_MSG spec:\r\n// https://github.com/mongodb/specifications/blob/master/source/message/OP_MSG.rst\r\n//\r\n// struct Section {\r\n//   uint8 payloadType;\r\n//   union payload {\r\n//       document  document; // payloadType == 0\r\n//       struct sequence { // payloadType == 1\r\n//           int32      size;\r\n//           cstring    identifier;\r\n//           document*  documents;\r\n//       };\r\n//   };\r\n// };\r\n\r\n// struct OP_MSG {\r\n//   struct MsgHeader {\r\n//       int32  messageLength;\r\n//       int32  requestID;\r\n//       int32  responseTo;\r\n//       int32  opCode = 2013;\r\n//   };\r\n//   uint32      flagBits;\r\n//   Section+    sections;\r\n//   [uint32     checksum;]\r\n// };\r\n\r\n// Msg Flags\r\nconst OPTS_CHECKSUM_PRESENT = 1;\r\nconst OPTS_MORE_TO_COME = 2;\r\nconst OPTS_EXHAUST_ALLOWED = 1 << 16;\r\n\r\n/** @internal */\r\nexport interface OpMsgOptions {\r\n  requestId: number;\r\n  serializeFunctions: boolean;\r\n  ignoreUndefined: boolean;\r\n  checkKeys: boolean;\r\n  maxBsonSize: number;\r\n  moreToCome: boolean;\r\n  exhaustAllowed: boolean;\r\n  readPreference: ReadPreference;\r\n}\r\n\r\n/** @internal */\r\nexport class OpMsgRequest {\r\n  requestId: number;\r\n  serializeFunctions: boolean;\r\n  ignoreUndefined: boolean;\r\n  checkKeys: boolean;\r\n  maxBsonSize: number;\r\n  checksumPresent: boolean;\r\n  moreToCome: boolean;\r\n  exhaustAllowed: boolean;\r\n\r\n  constructor(\r\n    public databaseName: string,\r\n    public command: Document,\r\n    public options: OpQueryOptions\r\n  ) {\r\n    // Basic options needed to be passed in\r\n    if (command == null)\r\n      throw new MongoInvalidArgumentError('Query document must be specified for query');\r\n\r\n    // Basic options\r\n    this.command.$db = databaseName;\r\n\r\n    if (options.readPreference && options.readPreference.mode !== ReadPreference.PRIMARY) {\r\n      this.command.$readPreference = options.readPreference.toJSON();\r\n    }\r\n\r\n    // Ensure empty options\r\n    this.options = options ?? {};\r\n\r\n    // Additional options\r\n    this.requestId = options.requestId ? options.requestId : OpMsgRequest.getRequestId();\r\n\r\n    // Serialization option\r\n    this.serializeFunctions =\r\n      typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\r\n    this.ignoreUndefined =\r\n      typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\r\n    this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\r\n    this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\r\n\r\n    // flags\r\n    this.checksumPresent = false;\r\n    this.moreToCome = options.moreToCome || false;\r\n    this.exhaustAllowed =\r\n      typeof options.exhaustAllowed === 'boolean' ? options.exhaustAllowed : false;\r\n  }\r\n\r\n  toBin(): Buffer[] {\r\n    const buffers: Buffer[] = [];\r\n    let flags = 0;\r\n\r\n    if (this.checksumPresent) {\r\n      flags |= OPTS_CHECKSUM_PRESENT;\r\n    }\r\n\r\n    if (this.moreToCome) {\r\n      flags |= OPTS_MORE_TO_COME;\r\n    }\r\n\r\n    if (this.exhaustAllowed) {\r\n      flags |= OPTS_EXHAUST_ALLOWED;\r\n    }\r\n\r\n    const header = Buffer.alloc(\r\n      4 * 4 + // Header\r\n        4 // Flags\r\n    );\r\n\r\n    buffers.push(header);\r\n\r\n    let totalLength = header.length;\r\n    const command = this.command;\r\n    totalLength += this.makeDocumentSegment(buffers, command);\r\n\r\n    header.writeInt32LE(totalLength, 0); // messageLength\r\n    header.writeInt32LE(this.requestId, 4); // requestID\r\n    header.writeInt32LE(0, 8); // responseTo\r\n    header.writeInt32LE(OP_MSG, 12); // opCode\r\n    header.writeUInt32LE(flags, 16); // flags\r\n    return buffers;\r\n  }\r\n\r\n  makeDocumentSegment(buffers: Uint8Array[], document: Document): number {\r\n    const payloadTypeBuffer = Buffer.alloc(1);\r\n    payloadTypeBuffer[0] = 0;\r\n\r\n    const documentBuffer = this.serializeBson(document);\r\n    buffers.push(payloadTypeBuffer);\r\n    buffers.push(documentBuffer);\r\n\r\n    return payloadTypeBuffer.length + documentBuffer.length;\r\n  }\r\n\r\n  serializeBson(document: Document): Uint8Array {\r\n    return BSON.serialize(document, {\r\n      checkKeys: this.checkKeys,\r\n      serializeFunctions: this.serializeFunctions,\r\n      ignoreUndefined: this.ignoreUndefined\r\n    });\r\n  }\r\n\r\n  static getRequestId(): number {\r\n    _requestId = (_requestId + 1) & 0x7fffffff;\r\n    return _requestId;\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport class OpMsgResponse {\r\n  parsed: boolean;\r\n  raw: Buffer;\r\n  data: Buffer;\r\n  opts: OpResponseOptions;\r\n  length: number;\r\n  requestId: number;\r\n  responseTo: number;\r\n  opCode: number;\r\n  fromCompressed?: boolean;\r\n  responseFlags: number;\r\n  checksumPresent: boolean;\r\n  /** Indicates the server will be sending more responses on this connection */\r\n  moreToCome: boolean;\r\n  exhaustAllowed: boolean;\r\n  useBigInt64: boolean;\r\n  promoteLongs: boolean;\r\n  promoteValues: boolean;\r\n  promoteBuffers: boolean;\r\n  bsonRegExp: boolean;\r\n  documents: (Document | Buffer)[];\r\n  index?: number;\r\n\r\n  constructor(\r\n    message: Buffer,\r\n    msgHeader: MessageHeader,\r\n    msgBody: Buffer,\r\n    opts?: OpResponseOptions\r\n  ) {\r\n    this.parsed = false;\r\n    this.raw = message;\r\n    this.data = msgBody;\r\n    this.opts = opts ?? {\r\n      useBigInt64: false,\r\n      promoteLongs: true,\r\n      promoteValues: true,\r\n      promoteBuffers: false,\r\n      bsonRegExp: false\r\n    };\r\n\r\n    // Read the message header\r\n    this.length = msgHeader.length;\r\n    this.requestId = msgHeader.requestId;\r\n    this.responseTo = msgHeader.responseTo;\r\n    this.opCode = msgHeader.opCode;\r\n    this.fromCompressed = msgHeader.fromCompressed;\r\n\r\n    // Read response flags\r\n    this.responseFlags = msgBody.readInt32LE(0);\r\n    this.checksumPresent = (this.responseFlags & OPTS_CHECKSUM_PRESENT) !== 0;\r\n    this.moreToCome = (this.responseFlags & OPTS_MORE_TO_COME) !== 0;\r\n    this.exhaustAllowed = (this.responseFlags & OPTS_EXHAUST_ALLOWED) !== 0;\r\n    this.useBigInt64 = typeof this.opts.useBigInt64 === 'boolean' ? this.opts.useBigInt64 : false;\r\n    this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\r\n    this.promoteValues =\r\n      typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\r\n    this.promoteBuffers =\r\n      typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\r\n    this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\r\n\r\n    this.documents = [];\r\n  }\r\n\r\n  isParsed(): boolean {\r\n    return this.parsed;\r\n  }\r\n\r\n  parse(options: OpResponseOptions): void {\r\n    // Don't parse again if not needed\r\n    if (this.parsed) return;\r\n    options = options ?? {};\r\n\r\n    this.index = 4;\r\n    // Allow the return of raw documents instead of parsing\r\n    const raw = options.raw || false;\r\n    const documentsReturnedIn = options.documentsReturnedIn || null;\r\n    const useBigInt64 = options.useBigInt64 ?? this.opts.useBigInt64;\r\n    const promoteLongs = options.promoteLongs ?? this.opts.promoteLongs;\r\n    const promoteValues = options.promoteValues ?? this.opts.promoteValues;\r\n    const promoteBuffers = options.promoteBuffers ?? this.opts.promoteBuffers;\r\n    const bsonRegExp = options.bsonRegExp ?? this.opts.bsonRegExp;\r\n    const validation = this.parseBsonSerializationOptions(options);\r\n\r\n    // Set up the options\r\n    const bsonOptions: BSONSerializeOptions = {\r\n      useBigInt64,\r\n      promoteLongs,\r\n      promoteValues,\r\n      promoteBuffers,\r\n      bsonRegExp,\r\n      validation\r\n      // Due to the strictness of the BSON libraries validation option we need this cast\r\n    } as BSONSerializeOptions & { validation: { utf8: { writeErrors: boolean } } };\r\n\r\n    while (this.index < this.data.length) {\r\n      const payloadType = this.data.readUInt8(this.index++);\r\n      if (payloadType === 0) {\r\n        const bsonSize = this.data.readUInt32LE(this.index);\r\n        const bin = this.data.slice(this.index, this.index + bsonSize);\r\n        this.documents.push(raw ? bin : BSON.deserialize(bin, bsonOptions));\r\n        this.index += bsonSize;\r\n      } else if (payloadType === 1) {\r\n        // It was decided that no driver makes use of payload type 1\r\n\r\n        // TODO(NODE-3483): Replace with MongoDeprecationError\r\n        throw new MongoRuntimeError('OP_MSG Payload Type 1 detected unsupported protocol');\r\n      }\r\n    }\r\n\r\n    if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\r\n      const fieldsAsRaw: Document = {};\r\n      fieldsAsRaw[documentsReturnedIn] = true;\r\n      bsonOptions.fieldsAsRaw = fieldsAsRaw;\r\n      const doc = BSON.deserialize(this.documents[0] as Buffer, bsonOptions);\r\n      this.documents = [doc];\r\n    }\r\n\r\n    this.parsed = true;\r\n  }\r\n\r\n  parseBsonSerializationOptions({ enableUtf8Validation }: BSONSerializeOptions): {\r\n    utf8: { writeErrors: false } | false;\r\n  } {\r\n    if (enableUtf8Validation === false) {\r\n      return { utf8: false };\r\n    }\r\n\r\n    return { utf8: { writeErrors: false } };\r\n  }\r\n}\r\n\r\nconst MESSAGE_HEADER_SIZE = 16;\r\nconst COMPRESSION_DETAILS_SIZE = 9; // originalOpcode + uncompressedSize, compressorID\r\n\r\n/**\r\n * @internal\r\n *\r\n * An OP_COMPRESSED request wraps either an OP_QUERY or OP_MSG message.\r\n */\r\nexport class OpCompressedRequest {\r\n  constructor(\r\n    private command: WriteProtocolMessageType,\r\n    private options: { zlibCompressionLevel: number; agreedCompressor: CompressorName }\r\n  ) {}\r\n\r\n  // Return whether a command contains an uncompressible command term\r\n  // Will return true if command contains no uncompressible command terms\r\n  static canCompress(command: WriteProtocolMessageType) {\r\n    const commandDoc = command instanceof OpMsgRequest ? command.command : command.query;\r\n    const commandName = Object.keys(commandDoc)[0];\r\n    return !uncompressibleCommands.has(commandName);\r\n  }\r\n\r\n  async toBin(): Promise<Buffer[]> {\r\n    const concatenatedOriginalCommandBuffer = Buffer.concat(this.command.toBin());\r\n    // otherwise, compress the message\r\n    const messageToBeCompressed = concatenatedOriginalCommandBuffer.slice(MESSAGE_HEADER_SIZE);\r\n\r\n    // Extract information needed for OP_COMPRESSED from the uncompressed message\r\n    const originalCommandOpCode = concatenatedOriginalCommandBuffer.readInt32LE(12);\r\n\r\n    // Compress the message body\r\n    const compressedMessage = await compress(this.options, messageToBeCompressed);\r\n    // Create the msgHeader of OP_COMPRESSED\r\n    const msgHeader = Buffer.alloc(MESSAGE_HEADER_SIZE);\r\n    msgHeader.writeInt32LE(\r\n      MESSAGE_HEADER_SIZE + COMPRESSION_DETAILS_SIZE + compressedMessage.length,\r\n      0\r\n    ); // messageLength\r\n    msgHeader.writeInt32LE(this.command.requestId, 4); // requestID\r\n    msgHeader.writeInt32LE(0, 8); // responseTo (zero)\r\n    msgHeader.writeInt32LE(OP_COMPRESSED, 12); // opCode\r\n\r\n    // Create the compression details of OP_COMPRESSED\r\n    const compressionDetails = Buffer.alloc(COMPRESSION_DETAILS_SIZE);\r\n    compressionDetails.writeInt32LE(originalCommandOpCode, 0); // originalOpcode\r\n    compressionDetails.writeInt32LE(messageToBeCompressed.length, 4); // Size of the uncompressed compressedMessage, excluding the MsgHeader\r\n    compressionDetails.writeUInt8(Compressor[this.options.agreedCompressor], 8); // compressorID\r\n    return [msgHeader, compressionDetails, compressedMessage];\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}