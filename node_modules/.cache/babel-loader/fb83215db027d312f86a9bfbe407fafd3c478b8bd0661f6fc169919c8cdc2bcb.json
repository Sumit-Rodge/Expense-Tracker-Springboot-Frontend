{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MongoLogger = exports.defaultLogTransform = exports.stringifyWithMaxLen = exports.createStdioLogger = exports.parseSeverityFromString = exports.MongoLoggableComponent = exports.SEVERITY_LEVEL_MAP = exports.DEFAULT_MAX_DOCUMENT_LENGTH = exports.SeverityLevel = void 0;\nconst util_1 = require(\"util\");\nconst bson_1 = require(\"./bson\");\nconst constants_1 = require(\"./constants\");\nconst utils_1 = require(\"./utils\");\n/** @internal */\nexports.SeverityLevel = Object.freeze({\n  EMERGENCY: 'emergency',\n  ALERT: 'alert',\n  CRITICAL: 'critical',\n  ERROR: 'error',\n  WARNING: 'warn',\n  NOTICE: 'notice',\n  INFORMATIONAL: 'info',\n  DEBUG: 'debug',\n  TRACE: 'trace',\n  OFF: 'off'\n});\n/** @internal */\nexports.DEFAULT_MAX_DOCUMENT_LENGTH = 1000;\n/** @internal */\nclass SeverityLevelMap extends Map {\n  constructor(entries) {\n    const newEntries = [];\n    for (const [level, value] of entries) {\n      newEntries.push([value, level]);\n    }\n    newEntries.push(...entries);\n    super(newEntries);\n  }\n  getNumericSeverityLevel(severity) {\n    return this.get(severity);\n  }\n  getSeverityLevelName(level) {\n    return this.get(level);\n  }\n}\n/** @internal */\nexports.SEVERITY_LEVEL_MAP = new SeverityLevelMap([[exports.SeverityLevel.OFF, -Infinity], [exports.SeverityLevel.EMERGENCY, 0], [exports.SeverityLevel.ALERT, 1], [exports.SeverityLevel.CRITICAL, 2], [exports.SeverityLevel.ERROR, 3], [exports.SeverityLevel.WARNING, 4], [exports.SeverityLevel.NOTICE, 5], [exports.SeverityLevel.INFORMATIONAL, 6], [exports.SeverityLevel.DEBUG, 7], [exports.SeverityLevel.TRACE, 8]]);\n/** @internal */\nexports.MongoLoggableComponent = Object.freeze({\n  COMMAND: 'command',\n  TOPOLOGY: 'topology',\n  SERVER_SELECTION: 'serverSelection',\n  CONNECTION: 'connection',\n  CLIENT: 'client'\n});\n/**\r\n * Parses a string as one of SeverityLevel\r\n * @internal\r\n *\r\n * @param s - the value to be parsed\r\n * @returns one of SeverityLevel if value can be parsed as such, otherwise null\r\n */\nfunction parseSeverityFromString(s) {\n  const validSeverities = Object.values(exports.SeverityLevel);\n  const lowerSeverity = s?.toLowerCase();\n  if (lowerSeverity != null && validSeverities.includes(lowerSeverity)) {\n    return lowerSeverity;\n  }\n  return null;\n}\nexports.parseSeverityFromString = parseSeverityFromString;\n/** @internal */\nfunction createStdioLogger(stream) {\n  return {\n    write: (0, util_1.promisify)((log, cb) => {\n      stream.write((0, util_1.inspect)(log, {\n        compact: true,\n        breakLength: Infinity\n      }), 'utf-8', cb);\n      return;\n    })\n  };\n}\nexports.createStdioLogger = createStdioLogger;\n/**\r\n * resolves the MONGODB_LOG_PATH and mongodbLogPath options from the environment and the\r\n * mongo client options respectively. The mongodbLogPath can be either 'stdout', 'stderr', a NodeJS\r\n * Writable or an object which has a `write` method with the signature:\r\n * ```ts\r\n * write(log: Log): void\r\n * ```\r\n *\r\n * @returns the MongoDBLogWritable object to write logs to\r\n */\nfunction resolveLogPath({\n  MONGODB_LOG_PATH\n}, {\n  mongodbLogPath\n}) {\n  if (typeof mongodbLogPath === 'string' && /^stderr$/i.test(mongodbLogPath)) {\n    return {\n      mongodbLogPath: createStdioLogger(process.stderr),\n      mongodbLogPathIsStdErr: true\n    };\n  }\n  if (typeof mongodbLogPath === 'string' && /^stdout$/i.test(mongodbLogPath)) {\n    return {\n      mongodbLogPath: createStdioLogger(process.stdout),\n      mongodbLogPathIsStdErr: false\n    };\n  }\n  if (typeof mongodbLogPath === 'object' && typeof mongodbLogPath?.write === 'function') {\n    return {\n      mongodbLogPath: mongodbLogPath,\n      mongodbLogPathIsStdErr: false\n    };\n  }\n  if (MONGODB_LOG_PATH && /^stderr$/i.test(MONGODB_LOG_PATH)) {\n    return {\n      mongodbLogPath: createStdioLogger(process.stderr),\n      mongodbLogPathIsStdErr: true\n    };\n  }\n  if (MONGODB_LOG_PATH && /^stdout$/i.test(MONGODB_LOG_PATH)) {\n    return {\n      mongodbLogPath: createStdioLogger(process.stdout),\n      mongodbLogPathIsStdErr: false\n    };\n  }\n  return {\n    mongodbLogPath: createStdioLogger(process.stderr),\n    mongodbLogPathIsStdErr: true\n  };\n}\nfunction resolveSeverityConfiguration(clientOption, environmentOption, defaultSeverity) {\n  return parseSeverityFromString(clientOption) ?? parseSeverityFromString(environmentOption) ?? defaultSeverity;\n}\nfunction compareSeverity(s0, s1) {\n  const s0Num = exports.SEVERITY_LEVEL_MAP.getNumericSeverityLevel(s0);\n  const s1Num = exports.SEVERITY_LEVEL_MAP.getNumericSeverityLevel(s1);\n  return s0Num < s1Num ? -1 : s0Num > s1Num ? 1 : 0;\n}\n/** @internal */\nfunction stringifyWithMaxLen(value, maxDocumentLength, options = {}) {\n  let strToTruncate = '';\n  if (typeof value === 'string') {\n    strToTruncate = value;\n  } else if (typeof value === 'function') {\n    strToTruncate = value.name;\n  } else {\n    try {\n      strToTruncate = bson_1.EJSON.stringify(value, options);\n    } catch (e) {\n      strToTruncate = `Extended JSON serialization failed with: ${e.message}`;\n    }\n  }\n  // handle truncation that occurs in the middle of multi-byte codepoints\n  if (maxDocumentLength !== 0 && strToTruncate.length > maxDocumentLength && strToTruncate.charCodeAt(maxDocumentLength - 1) !== strToTruncate.codePointAt(maxDocumentLength - 1)) {\n    maxDocumentLength--;\n    if (maxDocumentLength === 0) {\n      return '';\n    }\n  }\n  return maxDocumentLength !== 0 && strToTruncate.length > maxDocumentLength ? `${strToTruncate.slice(0, maxDocumentLength)}...` : strToTruncate;\n}\nexports.stringifyWithMaxLen = stringifyWithMaxLen;\nfunction isLogConvertible(obj) {\n  const objAsLogConvertible = obj;\n  // eslint-disable-next-line no-restricted-syntax\n  return objAsLogConvertible.toLog !== undefined && typeof objAsLogConvertible.toLog === 'function';\n}\nfunction attachServerSelectionFields(log, serverSelectionEvent, maxDocumentLength = exports.DEFAULT_MAX_DOCUMENT_LENGTH) {\n  const {\n    selector,\n    operation,\n    topologyDescription,\n    message\n  } = serverSelectionEvent;\n  log.selector = stringifyWithMaxLen(selector, maxDocumentLength);\n  log.operation = operation;\n  log.topologyDescription = stringifyWithMaxLen(topologyDescription, maxDocumentLength);\n  log.message = message;\n  return log;\n}\nfunction attachCommandFields(log, commandEvent) {\n  log.commandName = commandEvent.commandName;\n  log.requestId = commandEvent.requestId;\n  log.driverConnectionId = commandEvent.connectionId;\n  const {\n    host,\n    port\n  } = utils_1.HostAddress.fromString(commandEvent.address).toHostPort();\n  log.serverHost = host;\n  log.serverPort = port;\n  if (commandEvent?.serviceId) {\n    log.serviceId = commandEvent.serviceId.toHexString();\n  }\n  log.databaseName = commandEvent.databaseName;\n  log.serverConnectionId = commandEvent.serverConnectionId;\n  return log;\n}\nfunction attachConnectionFields(log, event) {\n  const {\n    host,\n    port\n  } = utils_1.HostAddress.fromString(event.address).toHostPort();\n  log.serverHost = host;\n  log.serverPort = port;\n  return log;\n}\nfunction attachSDAMFields(log, sdamEvent) {\n  log.topologyId = sdamEvent.topologyId;\n  return log;\n}\nfunction attachServerHeartbeatFields(log, serverHeartbeatEvent) {\n  const {\n    awaited,\n    connectionId\n  } = serverHeartbeatEvent;\n  log.awaited = awaited;\n  log.driverConnectionId = serverHeartbeatEvent.connectionId;\n  const {\n    host,\n    port\n  } = utils_1.HostAddress.fromString(connectionId).toHostPort();\n  log.serverHost = host;\n  log.serverPort = port;\n  return log;\n}\n/** @internal */\nfunction defaultLogTransform(logObject, maxDocumentLength = exports.DEFAULT_MAX_DOCUMENT_LENGTH) {\n  let log = Object.create(null);\n  switch (logObject.name) {\n    case constants_1.SERVER_SELECTION_STARTED:\n      log = attachServerSelectionFields(log, logObject, maxDocumentLength);\n      return log;\n    case constants_1.SERVER_SELECTION_FAILED:\n      log = attachServerSelectionFields(log, logObject, maxDocumentLength);\n      log.failure = logObject.failure?.message;\n      return log;\n    case constants_1.SERVER_SELECTION_SUCCEEDED:\n      log = attachServerSelectionFields(log, logObject, maxDocumentLength);\n      log.serverHost = logObject.serverHost;\n      log.serverPort = logObject.serverPort;\n      return log;\n    case constants_1.WAITING_FOR_SUITABLE_SERVER:\n      log = attachServerSelectionFields(log, logObject, maxDocumentLength);\n      log.remainingTimeMS = logObject.remainingTimeMS;\n      return log;\n    case constants_1.COMMAND_STARTED:\n      log = attachCommandFields(log, logObject);\n      log.message = 'Command started';\n      log.command = stringifyWithMaxLen(logObject.command, maxDocumentLength, {\n        relaxed: true\n      });\n      log.databaseName = logObject.databaseName;\n      return log;\n    case constants_1.COMMAND_SUCCEEDED:\n      log = attachCommandFields(log, logObject);\n      log.message = 'Command succeeded';\n      log.durationMS = logObject.duration;\n      log.reply = stringifyWithMaxLen(logObject.reply, maxDocumentLength, {\n        relaxed: true\n      });\n      return log;\n    case constants_1.COMMAND_FAILED:\n      log = attachCommandFields(log, logObject);\n      log.message = 'Command failed';\n      log.durationMS = logObject.duration;\n      log.failure = logObject.failure?.message ?? '(redacted)';\n      return log;\n    case constants_1.CONNECTION_POOL_CREATED:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection pool created';\n      if (logObject.options) {\n        const {\n          maxIdleTimeMS,\n          minPoolSize,\n          maxPoolSize,\n          maxConnecting,\n          waitQueueTimeoutMS\n        } = logObject.options;\n        log = {\n          ...log,\n          maxIdleTimeMS,\n          minPoolSize,\n          maxPoolSize,\n          maxConnecting,\n          waitQueueTimeoutMS\n        };\n      }\n      return log;\n    case constants_1.CONNECTION_POOL_READY:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection pool ready';\n      return log;\n    case constants_1.CONNECTION_POOL_CLEARED:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection pool cleared';\n      if (logObject.serviceId?._bsontype === 'ObjectId') {\n        log.serviceId = logObject.serviceId?.toHexString();\n      }\n      return log;\n    case constants_1.CONNECTION_POOL_CLOSED:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection pool closed';\n      return log;\n    case constants_1.CONNECTION_CREATED:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection created';\n      log.driverConnectionId = logObject.connectionId;\n      return log;\n    case constants_1.CONNECTION_READY:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection ready';\n      log.driverConnectionId = logObject.connectionId;\n      return log;\n    case constants_1.CONNECTION_CLOSED:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection closed';\n      log.driverConnectionId = logObject.connectionId;\n      switch (logObject.reason) {\n        case 'stale':\n          log.reason = 'Connection became stale because the pool was cleared';\n          break;\n        case 'idle':\n          log.reason = 'Connection has been available but unused for longer than the configured max idle time';\n          break;\n        case 'error':\n          log.reason = 'An error occurred while using the connection';\n          if (logObject.error) {\n            log.error = logObject.error;\n          }\n          break;\n        case 'poolClosed':\n          log.reason = 'Connection pool was closed';\n          break;\n        default:\n          log.reason = `Unknown close reason: ${logObject.reason}`;\n      }\n      return log;\n    case constants_1.CONNECTION_CHECK_OUT_STARTED:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection checkout started';\n      return log;\n    case constants_1.CONNECTION_CHECK_OUT_FAILED:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection checkout failed';\n      switch (logObject.reason) {\n        case 'poolClosed':\n          log.reason = 'Connection pool was closed';\n          break;\n        case 'timeout':\n          log.reason = 'Wait queue timeout elapsed without a connection becoming available';\n          break;\n        case 'connectionError':\n          log.reason = 'An error occurred while trying to establish a new connection';\n          if (logObject.error) {\n            log.error = logObject.error;\n          }\n          break;\n        default:\n          log.reason = `Unknown close reason: ${logObject.reason}`;\n      }\n      return log;\n    case constants_1.CONNECTION_CHECKED_OUT:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection checked out';\n      log.driverConnectionId = logObject.connectionId;\n      return log;\n    case constants_1.CONNECTION_CHECKED_IN:\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Connection checked in';\n      log.driverConnectionId = logObject.connectionId;\n      return log;\n    case constants_1.SERVER_OPENING:\n      log = attachSDAMFields(log, logObject);\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Starting server monitoring';\n      return log;\n    case constants_1.SERVER_CLOSED:\n      log = attachSDAMFields(log, logObject);\n      log = attachConnectionFields(log, logObject);\n      log.message = 'Stopped server monitoring';\n      return log;\n    case constants_1.SERVER_HEARTBEAT_STARTED:\n      log = attachSDAMFields(log, logObject);\n      log = attachServerHeartbeatFields(log, logObject);\n      log.message = 'Server heartbeat started';\n      return log;\n    case constants_1.SERVER_HEARTBEAT_SUCCEEDED:\n      log = attachSDAMFields(log, logObject);\n      log = attachServerHeartbeatFields(log, logObject);\n      log.message = 'Server heartbeat succeeded';\n      log.durationMS = logObject.duration;\n      log.serverConnectionId = logObject.serverConnectionId;\n      log.reply = stringifyWithMaxLen(logObject.reply, maxDocumentLength, {\n        relaxed: true\n      });\n      return log;\n    case constants_1.SERVER_HEARTBEAT_FAILED:\n      log = attachSDAMFields(log, logObject);\n      log = attachServerHeartbeatFields(log, logObject);\n      log.message = 'Server heartbeat failed';\n      log.durationMS = logObject.duration;\n      log.failure = logObject.failure?.message;\n      return log;\n    case constants_1.TOPOLOGY_OPENING:\n      log = attachSDAMFields(log, logObject);\n      log.message = 'Starting topology monitoring';\n      return log;\n    case constants_1.TOPOLOGY_CLOSED:\n      log = attachSDAMFields(log, logObject);\n      log.message = 'Stopped topology monitoring';\n      return log;\n    case constants_1.TOPOLOGY_DESCRIPTION_CHANGED:\n      log = attachSDAMFields(log, logObject);\n      log.message = 'Topology description changed';\n      log.previousDescription = log.reply = stringifyWithMaxLen(logObject.previousDescription, maxDocumentLength);\n      log.newDescription = log.reply = stringifyWithMaxLen(logObject.newDescription, maxDocumentLength);\n      return log;\n    default:\n      for (const [key, value] of Object.entries(logObject)) {\n        if (value != null) log[key] = value;\n      }\n  }\n  return log;\n}\nexports.defaultLogTransform = defaultLogTransform;\n/** @internal */\nclass MongoLogger {\n  constructor(options) {\n    this.pendingLog = null;\n    /**\r\n     * This method should be used when logging errors that do not have a public driver API for\r\n     * reporting errors.\r\n     */\n    this.error = this.log.bind(this, 'error');\n    /**\r\n     * This method should be used to log situations where undesirable application behaviour might\r\n     * occur. For example, failing to end sessions on `MongoClient.close`.\r\n     */\n    this.warn = this.log.bind(this, 'warn');\n    /**\r\n     * This method should be used to report high-level information about normal driver behaviour.\r\n     * For example, the creation of a `MongoClient`.\r\n     */\n    this.info = this.log.bind(this, 'info');\n    /**\r\n     * This method should be used to report information that would be helpful when debugging an\r\n     * application. For example, a command starting, succeeding or failing.\r\n     */\n    this.debug = this.log.bind(this, 'debug');\n    /**\r\n     * This method should be used to report fine-grained details related to logic flow. For example,\r\n     * entering and exiting a function body.\r\n     */\n    this.trace = this.log.bind(this, 'trace');\n    this.componentSeverities = options.componentSeverities;\n    this.maxDocumentLength = options.maxDocumentLength;\n    this.logDestination = options.logDestination;\n    this.logDestinationIsStdErr = options.logDestinationIsStdErr;\n    this.severities = this.createLoggingSeverities();\n  }\n  createLoggingSeverities() {\n    const severities = Object();\n    for (const component of Object.values(exports.MongoLoggableComponent)) {\n      severities[component] = {};\n      for (const severityLevel of Object.values(exports.SeverityLevel)) {\n        severities[component][severityLevel] = compareSeverity(severityLevel, this.componentSeverities[component]) <= 0;\n      }\n    }\n    return severities;\n  }\n  turnOffSeverities() {\n    for (const component of Object.values(exports.MongoLoggableComponent)) {\n      this.componentSeverities[component] = exports.SeverityLevel.OFF;\n      for (const severityLevel of Object.values(exports.SeverityLevel)) {\n        this.severities[component][severityLevel] = false;\n      }\n    }\n  }\n  logWriteFailureHandler(error) {\n    if (this.logDestinationIsStdErr) {\n      this.turnOffSeverities();\n      this.clearPendingLog();\n      return;\n    }\n    this.logDestination = createStdioLogger(process.stderr);\n    this.logDestinationIsStdErr = true;\n    this.clearPendingLog();\n    this.error(exports.MongoLoggableComponent.CLIENT, {\n      toLog: function () {\n        return {\n          message: 'User input for mongodbLogPath is now invalid. Logging is halted.',\n          error: error.message\n        };\n      }\n    });\n    this.turnOffSeverities();\n    this.clearPendingLog();\n  }\n  clearPendingLog() {\n    this.pendingLog = null;\n  }\n  willLog(component, severity) {\n    if (severity === exports.SeverityLevel.OFF) return false;\n    return this.severities[component][severity];\n  }\n  log(severity, component, message) {\n    if (!this.willLog(component, severity)) return;\n    let logMessage = {\n      t: new Date(),\n      c: component,\n      s: severity\n    };\n    if (typeof message === 'string') {\n      logMessage.message = message;\n    } else if (typeof message === 'object') {\n      if (isLogConvertible(message)) {\n        logMessage = {\n          ...logMessage,\n          ...message.toLog()\n        };\n      } else {\n        logMessage = {\n          ...logMessage,\n          ...defaultLogTransform(message, this.maxDocumentLength)\n        };\n      }\n    }\n    if ((0, utils_1.isPromiseLike)(this.pendingLog)) {\n      this.pendingLog = this.pendingLog.then(() => this.logDestination.write(logMessage)).then(this.clearPendingLog.bind(this), this.logWriteFailureHandler.bind(this));\n      return;\n    }\n    try {\n      const logResult = this.logDestination.write(logMessage);\n      if ((0, utils_1.isPromiseLike)(logResult)) {\n        this.pendingLog = logResult.then(this.clearPendingLog.bind(this), this.logWriteFailureHandler.bind(this));\n      }\n    } catch (error) {\n      this.logWriteFailureHandler(error);\n    }\n  }\n  /**\r\n   * Merges options set through environment variables and the MongoClient, preferring environment\r\n   * variables when both are set, and substituting defaults for values not set. Options set in\r\n   * constructor take precedence over both environment variables and MongoClient options.\r\n   *\r\n   * @remarks\r\n   * When parsing component severity levels, invalid values are treated as unset and replaced with\r\n   * the default severity.\r\n   *\r\n   * @param envOptions - options set for the logger from the environment\r\n   * @param clientOptions - options set for the logger in the MongoClient options\r\n   * @returns a MongoLoggerOptions object to be used when instantiating a new MongoLogger\r\n   */\n  static resolveOptions(envOptions, clientOptions) {\n    // client options take precedence over env options\n    const resolvedLogPath = resolveLogPath(envOptions, clientOptions);\n    const combinedOptions = {\n      ...envOptions,\n      ...clientOptions,\n      mongodbLogPath: resolvedLogPath.mongodbLogPath,\n      mongodbLogPathIsStdErr: resolvedLogPath.mongodbLogPathIsStdErr\n    };\n    const defaultSeverity = resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.default, combinedOptions.MONGODB_LOG_ALL, exports.SeverityLevel.OFF);\n    return {\n      componentSeverities: {\n        command: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.command, combinedOptions.MONGODB_LOG_COMMAND, defaultSeverity),\n        topology: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.topology, combinedOptions.MONGODB_LOG_TOPOLOGY, defaultSeverity),\n        serverSelection: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.serverSelection, combinedOptions.MONGODB_LOG_SERVER_SELECTION, defaultSeverity),\n        connection: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.connection, combinedOptions.MONGODB_LOG_CONNECTION, defaultSeverity),\n        client: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.client, combinedOptions.MONGODB_LOG_CLIENT, defaultSeverity),\n        default: defaultSeverity\n      },\n      maxDocumentLength: combinedOptions.mongodbLogMaxDocumentLength ?? (0, utils_1.parseUnsignedInteger)(combinedOptions.MONGODB_LOG_MAX_DOCUMENT_LENGTH) ?? 1000,\n      logDestination: combinedOptions.mongodbLogPath,\n      logDestinationIsStdErr: combinedOptions.mongodbLogPathIsStdErr\n    };\n  }\n}\nexports.MongoLogger = MongoLogger;","map":{"version":3,"names":["util_1","require","bson_1","constants_1","utils_1","exports","SeverityLevel","Object","freeze","EMERGENCY","ALERT","CRITICAL","ERROR","WARNING","NOTICE","INFORMATIONAL","DEBUG","TRACE","OFF","DEFAULT_MAX_DOCUMENT_LENGTH","SeverityLevelMap","Map","constructor","entries","newEntries","level","value","push","getNumericSeverityLevel","severity","get","getSeverityLevelName","SEVERITY_LEVEL_MAP","Infinity","MongoLoggableComponent","COMMAND","TOPOLOGY","SERVER_SELECTION","CONNECTION","CLIENT","parseSeverityFromString","s","validSeverities","values","lowerSeverity","toLowerCase","includes","createStdioLogger","stream","write","promisify","log","cb","inspect","compact","breakLength","resolveLogPath","MONGODB_LOG_PATH","mongodbLogPath","test","process","stderr","mongodbLogPathIsStdErr","stdout","resolveSeverityConfiguration","clientOption","environmentOption","defaultSeverity","compareSeverity","s0","s1","s0Num","s1Num","stringifyWithMaxLen","maxDocumentLength","options","strToTruncate","name","EJSON","stringify","e","message","length","charCodeAt","codePointAt","slice","isLogConvertible","obj","objAsLogConvertible","toLog","undefined","attachServerSelectionFields","serverSelectionEvent","selector","operation","topologyDescription","attachCommandFields","commandEvent","commandName","requestId","driverConnectionId","connectionId","host","port","HostAddress","fromString","address","toHostPort","serverHost","serverPort","serviceId","toHexString","databaseName","serverConnectionId","attachConnectionFields","event","attachSDAMFields","sdamEvent","topologyId","attachServerHeartbeatFields","serverHeartbeatEvent","awaited","defaultLogTransform","logObject","create","SERVER_SELECTION_STARTED","SERVER_SELECTION_FAILED","failure","SERVER_SELECTION_SUCCEEDED","WAITING_FOR_SUITABLE_SERVER","remainingTimeMS","COMMAND_STARTED","command","relaxed","COMMAND_SUCCEEDED","durationMS","duration","reply","COMMAND_FAILED","CONNECTION_POOL_CREATED","maxIdleTimeMS","minPoolSize","maxPoolSize","maxConnecting","waitQueueTimeoutMS","CONNECTION_POOL_READY","CONNECTION_POOL_CLEARED","_bsontype","CONNECTION_POOL_CLOSED","CONNECTION_CREATED","CONNECTION_READY","CONNECTION_CLOSED","reason","error","CONNECTION_CHECK_OUT_STARTED","CONNECTION_CHECK_OUT_FAILED","CONNECTION_CHECKED_OUT","CONNECTION_CHECKED_IN","SERVER_OPENING","SERVER_CLOSED","SERVER_HEARTBEAT_STARTED","SERVER_HEARTBEAT_SUCCEEDED","SERVER_HEARTBEAT_FAILED","TOPOLOGY_OPENING","TOPOLOGY_CLOSED","TOPOLOGY_DESCRIPTION_CHANGED","previousDescription","newDescription","key","MongoLogger","pendingLog","bind","warn","info","debug","trace","componentSeverities","logDestination","logDestinationIsStdErr","severities","createLoggingSeverities","component","severityLevel","turnOffSeverities","logWriteFailureHandler","clearPendingLog","willLog","logMessage","t","Date","c","isPromiseLike","then","logResult","resolveOptions","envOptions","clientOptions","resolvedLogPath","combinedOptions","mongodbLogComponentSeverities","default","MONGODB_LOG_ALL","MONGODB_LOG_COMMAND","topology","MONGODB_LOG_TOPOLOGY","serverSelection","MONGODB_LOG_SERVER_SELECTION","connection","MONGODB_LOG_CONNECTION","client","MONGODB_LOG_CLIENT","mongodbLogMaxDocumentLength","parseUnsignedInteger","MONGODB_LOG_MAX_DOCUMENT_LENGTH"],"sources":["C:\\Users\\sumit\\Desktop\\Final project\\Expense-Tracker-Springboot-Frontend\\node_modules\\mongodb\\src\\mongo_logger.ts"],"sourcesContent":["import { inspect, promisify } from 'util';\r\n\r\nimport { type Document, EJSON, type EJSONOptions, type ObjectId } from './bson';\r\nimport type { CommandStartedEvent } from './cmap/command_monitoring_events';\r\nimport type {\r\n  ConnectionCheckedInEvent,\r\n  ConnectionCheckedOutEvent,\r\n  ConnectionCheckOutFailedEvent,\r\n  ConnectionCheckOutStartedEvent,\r\n  ConnectionClosedEvent,\r\n  ConnectionCreatedEvent,\r\n  ConnectionPoolClearedEvent,\r\n  ConnectionPoolClosedEvent,\r\n  ConnectionPoolCreatedEvent,\r\n  ConnectionPoolReadyEvent,\r\n  ConnectionReadyEvent\r\n} from './cmap/connection_pool_events';\r\nimport {\r\n  COMMAND_FAILED,\r\n  COMMAND_STARTED,\r\n  COMMAND_SUCCEEDED,\r\n  CONNECTION_CHECK_OUT_FAILED,\r\n  CONNECTION_CHECK_OUT_STARTED,\r\n  CONNECTION_CHECKED_IN,\r\n  CONNECTION_CHECKED_OUT,\r\n  CONNECTION_CLOSED,\r\n  CONNECTION_CREATED,\r\n  CONNECTION_POOL_CLEARED,\r\n  CONNECTION_POOL_CLOSED,\r\n  CONNECTION_POOL_CREATED,\r\n  CONNECTION_POOL_READY,\r\n  CONNECTION_READY,\r\n  SERVER_CLOSED,\r\n  SERVER_HEARTBEAT_FAILED,\r\n  SERVER_HEARTBEAT_STARTED,\r\n  SERVER_HEARTBEAT_SUCCEEDED,\r\n  SERVER_OPENING,\r\n  SERVER_SELECTION_FAILED,\r\n  SERVER_SELECTION_STARTED,\r\n  SERVER_SELECTION_SUCCEEDED,\r\n  TOPOLOGY_CLOSED,\r\n  TOPOLOGY_DESCRIPTION_CHANGED,\r\n  TOPOLOGY_OPENING,\r\n  WAITING_FOR_SUITABLE_SERVER\r\n} from './constants';\r\nimport type {\r\n  ServerClosedEvent,\r\n  ServerOpeningEvent,\r\n  TopologyClosedEvent,\r\n  TopologyDescriptionChangedEvent,\r\n  TopologyOpeningEvent\r\n} from './sdam/events';\r\nimport type {\r\n  ServerSelectionEvent,\r\n  ServerSelectionFailedEvent,\r\n  ServerSelectionStartedEvent,\r\n  ServerSelectionSucceededEvent,\r\n  WaitingForSuitableServerEvent\r\n} from './sdam/server_selection_events';\r\nimport { HostAddress, isPromiseLike, parseUnsignedInteger } from './utils';\r\n\r\n/** @internal */\r\nexport const SeverityLevel = Object.freeze({\r\n  EMERGENCY: 'emergency',\r\n  ALERT: 'alert',\r\n  CRITICAL: 'critical',\r\n  ERROR: 'error',\r\n  WARNING: 'warn',\r\n  NOTICE: 'notice',\r\n  INFORMATIONAL: 'info',\r\n  DEBUG: 'debug',\r\n  TRACE: 'trace',\r\n  OFF: 'off'\r\n} as const);\r\n\r\n/** @internal */\r\nexport const DEFAULT_MAX_DOCUMENT_LENGTH = 1000;\r\n/** @internal */\r\nexport type SeverityLevel = (typeof SeverityLevel)[keyof typeof SeverityLevel];\r\n\r\n/** @internal */\r\nclass SeverityLevelMap extends Map<SeverityLevel | number, SeverityLevel | number> {\r\n  constructor(entries: [SeverityLevel | number, SeverityLevel | number][]) {\r\n    const newEntries: [number | SeverityLevel, SeverityLevel | number][] = [];\r\n    for (const [level, value] of entries) {\r\n      newEntries.push([value, level]);\r\n    }\r\n\r\n    newEntries.push(...entries);\r\n    super(newEntries);\r\n  }\r\n\r\n  getNumericSeverityLevel(severity: SeverityLevel): number {\r\n    return this.get(severity) as number;\r\n  }\r\n\r\n  getSeverityLevelName(level: number): SeverityLevel | undefined {\r\n    return this.get(level) as SeverityLevel | undefined;\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport const SEVERITY_LEVEL_MAP = new SeverityLevelMap([\r\n  [SeverityLevel.OFF, -Infinity],\r\n  [SeverityLevel.EMERGENCY, 0],\r\n  [SeverityLevel.ALERT, 1],\r\n  [SeverityLevel.CRITICAL, 2],\r\n  [SeverityLevel.ERROR, 3],\r\n  [SeverityLevel.WARNING, 4],\r\n  [SeverityLevel.NOTICE, 5],\r\n  [SeverityLevel.INFORMATIONAL, 6],\r\n  [SeverityLevel.DEBUG, 7],\r\n  [SeverityLevel.TRACE, 8]\r\n]);\r\n\r\n/** @internal */\r\nexport const MongoLoggableComponent = Object.freeze({\r\n  COMMAND: 'command',\r\n  TOPOLOGY: 'topology',\r\n  SERVER_SELECTION: 'serverSelection',\r\n  CONNECTION: 'connection',\r\n  CLIENT: 'client'\r\n} as const);\r\n\r\n/** @internal */\r\nexport type MongoLoggableComponent =\r\n  (typeof MongoLoggableComponent)[keyof typeof MongoLoggableComponent];\r\n\r\n/** @internal */\r\nexport interface MongoLoggerEnvOptions {\r\n  /** Severity level for command component */\r\n  MONGODB_LOG_COMMAND?: string;\r\n  /** Severity level for topology component */\r\n  MONGODB_LOG_TOPOLOGY?: string;\r\n  /** Severity level for server selection component */\r\n  MONGODB_LOG_SERVER_SELECTION?: string;\r\n  /** Severity level for CMAP */\r\n  MONGODB_LOG_CONNECTION?: string;\r\n  /** Severity level for client */\r\n  MONGODB_LOG_CLIENT?: string;\r\n  /** Default severity level to be if any of the above are unset */\r\n  MONGODB_LOG_ALL?: string;\r\n  /** Max length of embedded EJSON docs. Setting to 0 disables truncation. Defaults to 1000. */\r\n  MONGODB_LOG_MAX_DOCUMENT_LENGTH?: string;\r\n  /** Destination for log messages. Must be 'stderr', 'stdout'. Defaults to 'stderr'. */\r\n  MONGODB_LOG_PATH?: string;\r\n}\r\n\r\n/** @internal */\r\nexport interface LogComponentSeveritiesClientOptions {\r\n  /** Optional severity level for command component */\r\n  command?: SeverityLevel;\r\n  /** Optional severity level for topology component */\r\n  topology?: SeverityLevel;\r\n  /** Optionsl severity level for server selection component */\r\n  serverSelection?: SeverityLevel;\r\n  /** Optional severity level for connection component */\r\n  connection?: SeverityLevel;\r\n  /** Optional severity level for client component */\r\n  client?: SeverityLevel;\r\n  /** Optional default severity level to be used if any of the above are unset */\r\n  default?: SeverityLevel;\r\n}\r\n\r\n/** @internal */\r\nexport interface MongoLoggerMongoClientOptions {\r\n  /** Destination for log messages */\r\n  mongodbLogPath?: 'stdout' | 'stderr' | MongoDBLogWritable;\r\n  /** Severity levels for logger components */\r\n  mongodbLogComponentSeverities?: LogComponentSeveritiesClientOptions;\r\n  /** Max length of embedded EJSON docs. Setting to 0 disables truncation. Defaults to 1000. */\r\n  mongodbLogMaxDocumentLength?: number;\r\n}\r\n\r\n/** @internal */\r\nexport interface MongoLoggerOptions {\r\n  componentSeverities: {\r\n    /** Severity level for command component */\r\n    command: SeverityLevel;\r\n    /** Severity level for topology component */\r\n    topology: SeverityLevel;\r\n    /** Severity level for server selection component */\r\n    serverSelection: SeverityLevel;\r\n    /** Severity level for connection component */\r\n    connection: SeverityLevel;\r\n    /** Severity level for client component */\r\n    client: SeverityLevel;\r\n    /** Default severity level to be used if any of the above are unset */\r\n    default: SeverityLevel;\r\n  };\r\n  /** Max length of embedded EJSON docs. Setting to 0 disables truncation. Defaults to 1000. */\r\n  maxDocumentLength: number;\r\n  /** Destination for log messages. */\r\n  logDestination: MongoDBLogWritable;\r\n  /** For internal check to see if error should stop logging. */\r\n  logDestinationIsStdErr: boolean;\r\n}\r\n\r\n/**\r\n * Parses a string as one of SeverityLevel\r\n * @internal\r\n *\r\n * @param s - the value to be parsed\r\n * @returns one of SeverityLevel if value can be parsed as such, otherwise null\r\n */\r\nexport function parseSeverityFromString(s?: string): SeverityLevel | null {\r\n  const validSeverities: string[] = Object.values(SeverityLevel);\r\n  const lowerSeverity = s?.toLowerCase();\r\n\r\n  if (lowerSeverity != null && validSeverities.includes(lowerSeverity)) {\r\n    return lowerSeverity as SeverityLevel;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/** @internal */\r\nexport function createStdioLogger(stream: {\r\n  write: NodeJS.WriteStream['write'];\r\n}): MongoDBLogWritable {\r\n  return {\r\n    write: promisify((log: Log, cb: (error?: Error) => void): unknown => {\r\n      stream.write(inspect(log, { compact: true, breakLength: Infinity }), 'utf-8', cb);\r\n      return;\r\n    })\r\n  };\r\n}\r\n\r\n/**\r\n * resolves the MONGODB_LOG_PATH and mongodbLogPath options from the environment and the\r\n * mongo client options respectively. The mongodbLogPath can be either 'stdout', 'stderr', a NodeJS\r\n * Writable or an object which has a `write` method with the signature:\r\n * ```ts\r\n * write(log: Log): void\r\n * ```\r\n *\r\n * @returns the MongoDBLogWritable object to write logs to\r\n */\r\nfunction resolveLogPath(\r\n  { MONGODB_LOG_PATH }: MongoLoggerEnvOptions,\r\n  { mongodbLogPath }: MongoLoggerMongoClientOptions\r\n): { mongodbLogPath: MongoDBLogWritable; mongodbLogPathIsStdErr: boolean } {\r\n  if (typeof mongodbLogPath === 'string' && /^stderr$/i.test(mongodbLogPath)) {\r\n    return { mongodbLogPath: createStdioLogger(process.stderr), mongodbLogPathIsStdErr: true };\r\n  }\r\n  if (typeof mongodbLogPath === 'string' && /^stdout$/i.test(mongodbLogPath)) {\r\n    return { mongodbLogPath: createStdioLogger(process.stdout), mongodbLogPathIsStdErr: false };\r\n  }\r\n\r\n  if (typeof mongodbLogPath === 'object' && typeof mongodbLogPath?.write === 'function') {\r\n    return { mongodbLogPath: mongodbLogPath, mongodbLogPathIsStdErr: false };\r\n  }\r\n\r\n  if (MONGODB_LOG_PATH && /^stderr$/i.test(MONGODB_LOG_PATH)) {\r\n    return { mongodbLogPath: createStdioLogger(process.stderr), mongodbLogPathIsStdErr: true };\r\n  }\r\n  if (MONGODB_LOG_PATH && /^stdout$/i.test(MONGODB_LOG_PATH)) {\r\n    return { mongodbLogPath: createStdioLogger(process.stdout), mongodbLogPathIsStdErr: false };\r\n  }\r\n\r\n  return { mongodbLogPath: createStdioLogger(process.stderr), mongodbLogPathIsStdErr: true };\r\n}\r\n\r\nfunction resolveSeverityConfiguration(\r\n  clientOption: string | undefined,\r\n  environmentOption: string | undefined,\r\n  defaultSeverity: SeverityLevel\r\n): SeverityLevel {\r\n  return (\r\n    parseSeverityFromString(clientOption) ??\r\n    parseSeverityFromString(environmentOption) ??\r\n    defaultSeverity\r\n  );\r\n}\r\n\r\n/** @internal */\r\nexport interface Log extends Record<string, any> {\r\n  t: Date;\r\n  c: MongoLoggableComponent;\r\n  s: SeverityLevel;\r\n  message?: string;\r\n}\r\n\r\n/**\r\n * @internal\r\n * TODO: NODE-5671 - remove internal flag and add API comments\r\n */\r\nexport interface MongoDBLogWritable {\r\n  write(log: Log): PromiseLike<unknown> | unknown;\r\n}\r\n\r\nfunction compareSeverity(s0: SeverityLevel, s1: SeverityLevel): 1 | 0 | -1 {\r\n  const s0Num = SEVERITY_LEVEL_MAP.getNumericSeverityLevel(s0);\r\n  const s1Num = SEVERITY_LEVEL_MAP.getNumericSeverityLevel(s1);\r\n\r\n  return s0Num < s1Num ? -1 : s0Num > s1Num ? 1 : 0;\r\n}\r\n\r\n/**\r\n * @internal\r\n * Must be separate from Events API due to differences in spec requirements for logging a command success\r\n */\r\nexport type LoggableCommandSucceededEvent = {\r\n  address: string;\r\n  connectionId?: string | number;\r\n  requestId: number;\r\n  duration: number;\r\n  commandName: string;\r\n  reply: Document | undefined;\r\n  serviceId?: ObjectId;\r\n  name: typeof COMMAND_SUCCEEDED;\r\n  serverConnectionId: bigint | null;\r\n  databaseName: string;\r\n};\r\n\r\n/**\r\n * @internal\r\n * Must be separate from Events API due to differences in spec requirements for logging a command failure\r\n */\r\nexport type LoggableCommandFailedEvent = {\r\n  address: string;\r\n  connectionId?: string | number;\r\n  requestId: number;\r\n  duration: number;\r\n  commandName: string;\r\n  failure: Error;\r\n  serviceId?: ObjectId;\r\n  name: typeof COMMAND_FAILED;\r\n  serverConnectionId: bigint | null;\r\n  databaseName: string;\r\n};\r\n\r\n/**\r\n * @internal\r\n * Must be separate from Events API due to differences in spec requirements for logging server heartbeat beginning\r\n */\r\nexport type LoggableServerHeartbeatStartedEvent = {\r\n  topologyId: number;\r\n  awaited: boolean;\r\n  connectionId: string;\r\n  name: typeof SERVER_HEARTBEAT_STARTED;\r\n};\r\n\r\n/**\r\n * @internal\r\n * Must be separate from Events API due to differences in spec requirements for logging server heartbeat success\r\n */\r\nexport type LoggableServerHeartbeatSucceededEvent = {\r\n  topologyId: number;\r\n  awaited: boolean;\r\n  connectionId: string;\r\n  reply: Document;\r\n  serverConnectionId: number | '<monitor>';\r\n  duration: number;\r\n  name: typeof SERVER_HEARTBEAT_SUCCEEDED;\r\n};\r\n\r\n/**\r\n * @internal\r\n * Must be separate from Events API due to differences in spec requirements for logging server heartbeat failure\r\n */\r\nexport type LoggableServerHeartbeatFailedEvent = {\r\n  topologyId: number;\r\n  awaited: boolean;\r\n  connectionId: string;\r\n  failure: Error;\r\n  duration: number;\r\n  name: typeof SERVER_HEARTBEAT_FAILED;\r\n};\r\n\r\ntype SDAMLoggableEvent =\r\n  | ServerClosedEvent\r\n  | LoggableServerHeartbeatFailedEvent\r\n  | LoggableServerHeartbeatStartedEvent\r\n  | LoggableServerHeartbeatSucceededEvent\r\n  | ServerOpeningEvent\r\n  | TopologyClosedEvent\r\n  | TopologyDescriptionChangedEvent\r\n  | TopologyOpeningEvent;\r\n\r\n/** @internal */\r\nexport type LoggableEvent =\r\n  | ServerSelectionStartedEvent\r\n  | ServerSelectionFailedEvent\r\n  | ServerSelectionSucceededEvent\r\n  | WaitingForSuitableServerEvent\r\n  | CommandStartedEvent\r\n  | LoggableCommandSucceededEvent\r\n  | LoggableCommandFailedEvent\r\n  | ConnectionPoolCreatedEvent\r\n  | ConnectionPoolReadyEvent\r\n  | ConnectionPoolClosedEvent\r\n  | ConnectionPoolClearedEvent\r\n  | ConnectionCreatedEvent\r\n  | ConnectionReadyEvent\r\n  | ConnectionClosedEvent\r\n  | ConnectionCheckedInEvent\r\n  | ConnectionCheckedOutEvent\r\n  | ConnectionCheckOutStartedEvent\r\n  | ConnectionCheckOutFailedEvent\r\n  | ServerClosedEvent\r\n  | LoggableServerHeartbeatFailedEvent\r\n  | LoggableServerHeartbeatStartedEvent\r\n  | LoggableServerHeartbeatSucceededEvent\r\n  | ServerOpeningEvent\r\n  | TopologyClosedEvent\r\n  | TopologyDescriptionChangedEvent\r\n  | TopologyOpeningEvent;\r\n\r\n/** @internal */\r\nexport interface LogConvertible extends Record<string, any> {\r\n  toLog(): Record<string, any>;\r\n}\r\n\r\n/** @internal */\r\nexport function stringifyWithMaxLen(\r\n  value: any,\r\n  maxDocumentLength: number,\r\n  options: EJSONOptions = {}\r\n): string {\r\n  let strToTruncate = '';\r\n\r\n  if (typeof value === 'string') {\r\n    strToTruncate = value;\r\n  } else if (typeof value === 'function') {\r\n    strToTruncate = value.name;\r\n  } else {\r\n    try {\r\n      strToTruncate = EJSON.stringify(value, options);\r\n    } catch (e) {\r\n      strToTruncate = `Extended JSON serialization failed with: ${e.message}`;\r\n    }\r\n  }\r\n\r\n  // handle truncation that occurs in the middle of multi-byte codepoints\r\n  if (\r\n    maxDocumentLength !== 0 &&\r\n    strToTruncate.length > maxDocumentLength &&\r\n    strToTruncate.charCodeAt(maxDocumentLength - 1) !==\r\n      strToTruncate.codePointAt(maxDocumentLength - 1)\r\n  ) {\r\n    maxDocumentLength--;\r\n    if (maxDocumentLength === 0) {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  return maxDocumentLength !== 0 && strToTruncate.length > maxDocumentLength\r\n    ? `${strToTruncate.slice(0, maxDocumentLength)}...`\r\n    : strToTruncate;\r\n}\r\n\r\n/** @internal */\r\nexport type Loggable = LoggableEvent | LogConvertible;\r\n\r\nfunction isLogConvertible(obj: Loggable): obj is LogConvertible {\r\n  const objAsLogConvertible = obj as LogConvertible;\r\n  // eslint-disable-next-line no-restricted-syntax\r\n  return objAsLogConvertible.toLog !== undefined && typeof objAsLogConvertible.toLog === 'function';\r\n}\r\n\r\nfunction attachServerSelectionFields(\r\n  log: Record<string, any>,\r\n  serverSelectionEvent: ServerSelectionEvent,\r\n  maxDocumentLength: number = DEFAULT_MAX_DOCUMENT_LENGTH\r\n) {\r\n  const { selector, operation, topologyDescription, message } = serverSelectionEvent;\r\n  log.selector = stringifyWithMaxLen(selector, maxDocumentLength);\r\n  log.operation = operation;\r\n  log.topologyDescription = stringifyWithMaxLen(topologyDescription, maxDocumentLength);\r\n  log.message = message;\r\n\r\n  return log;\r\n}\r\n\r\nfunction attachCommandFields(\r\n  log: Record<string, any>,\r\n  commandEvent: CommandStartedEvent | LoggableCommandSucceededEvent | LoggableCommandFailedEvent\r\n) {\r\n  log.commandName = commandEvent.commandName;\r\n  log.requestId = commandEvent.requestId;\r\n  log.driverConnectionId = commandEvent.connectionId;\r\n  const { host, port } = HostAddress.fromString(commandEvent.address).toHostPort();\r\n  log.serverHost = host;\r\n  log.serverPort = port;\r\n  if (commandEvent?.serviceId) {\r\n    log.serviceId = commandEvent.serviceId.toHexString();\r\n  }\r\n  log.databaseName = commandEvent.databaseName;\r\n  log.serverConnectionId = commandEvent.serverConnectionId;\r\n\r\n  return log;\r\n}\r\n\r\nfunction attachConnectionFields(log: Record<string, any>, event: any) {\r\n  const { host, port } = HostAddress.fromString(event.address).toHostPort();\r\n  log.serverHost = host;\r\n  log.serverPort = port;\r\n\r\n  return log;\r\n}\r\n\r\nfunction attachSDAMFields(log: Record<string, any>, sdamEvent: SDAMLoggableEvent) {\r\n  log.topologyId = sdamEvent.topologyId;\r\n  return log;\r\n}\r\n\r\nfunction attachServerHeartbeatFields(\r\n  log: Record<string, any>,\r\n  serverHeartbeatEvent:\r\n    | LoggableServerHeartbeatFailedEvent\r\n    | LoggableServerHeartbeatStartedEvent\r\n    | LoggableServerHeartbeatSucceededEvent\r\n) {\r\n  const { awaited, connectionId } = serverHeartbeatEvent;\r\n  log.awaited = awaited;\r\n  log.driverConnectionId = serverHeartbeatEvent.connectionId;\r\n  const { host, port } = HostAddress.fromString(connectionId).toHostPort();\r\n  log.serverHost = host;\r\n  log.serverPort = port;\r\n  return log;\r\n}\r\n\r\n/** @internal */\r\nexport function defaultLogTransform(\r\n  logObject: LoggableEvent | Record<string, any>,\r\n  maxDocumentLength: number = DEFAULT_MAX_DOCUMENT_LENGTH\r\n): Omit<Log, 's' | 't' | 'c'> {\r\n  let log: Omit<Log, 's' | 't' | 'c'> = Object.create(null);\r\n\r\n  switch (logObject.name) {\r\n    case SERVER_SELECTION_STARTED:\r\n      log = attachServerSelectionFields(log, logObject, maxDocumentLength);\r\n      return log;\r\n    case SERVER_SELECTION_FAILED:\r\n      log = attachServerSelectionFields(log, logObject, maxDocumentLength);\r\n      log.failure = logObject.failure?.message;\r\n      return log;\r\n    case SERVER_SELECTION_SUCCEEDED:\r\n      log = attachServerSelectionFields(log, logObject, maxDocumentLength);\r\n      log.serverHost = logObject.serverHost;\r\n      log.serverPort = logObject.serverPort;\r\n      return log;\r\n    case WAITING_FOR_SUITABLE_SERVER:\r\n      log = attachServerSelectionFields(log, logObject, maxDocumentLength);\r\n      log.remainingTimeMS = logObject.remainingTimeMS;\r\n      return log;\r\n    case COMMAND_STARTED:\r\n      log = attachCommandFields(log, logObject);\r\n      log.message = 'Command started';\r\n      log.command = stringifyWithMaxLen(logObject.command, maxDocumentLength, { relaxed: true });\r\n      log.databaseName = logObject.databaseName;\r\n      return log;\r\n    case COMMAND_SUCCEEDED:\r\n      log = attachCommandFields(log, logObject);\r\n      log.message = 'Command succeeded';\r\n      log.durationMS = logObject.duration;\r\n      log.reply = stringifyWithMaxLen(logObject.reply, maxDocumentLength, { relaxed: true });\r\n      return log;\r\n    case COMMAND_FAILED:\r\n      log = attachCommandFields(log, logObject);\r\n      log.message = 'Command failed';\r\n      log.durationMS = logObject.duration;\r\n      log.failure = logObject.failure?.message ?? '(redacted)';\r\n      return log;\r\n    case CONNECTION_POOL_CREATED:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection pool created';\r\n      if (logObject.options) {\r\n        const { maxIdleTimeMS, minPoolSize, maxPoolSize, maxConnecting, waitQueueTimeoutMS } =\r\n          logObject.options;\r\n        log = {\r\n          ...log,\r\n          maxIdleTimeMS,\r\n          minPoolSize,\r\n          maxPoolSize,\r\n          maxConnecting,\r\n          waitQueueTimeoutMS\r\n        };\r\n      }\r\n      return log;\r\n    case CONNECTION_POOL_READY:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection pool ready';\r\n      return log;\r\n    case CONNECTION_POOL_CLEARED:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection pool cleared';\r\n      if (logObject.serviceId?._bsontype === 'ObjectId') {\r\n        log.serviceId = logObject.serviceId?.toHexString();\r\n      }\r\n      return log;\r\n    case CONNECTION_POOL_CLOSED:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection pool closed';\r\n      return log;\r\n    case CONNECTION_CREATED:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection created';\r\n      log.driverConnectionId = logObject.connectionId;\r\n      return log;\r\n    case CONNECTION_READY:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection ready';\r\n      log.driverConnectionId = logObject.connectionId;\r\n      return log;\r\n    case CONNECTION_CLOSED:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection closed';\r\n      log.driverConnectionId = logObject.connectionId;\r\n      switch (logObject.reason) {\r\n        case 'stale':\r\n          log.reason = 'Connection became stale because the pool was cleared';\r\n          break;\r\n        case 'idle':\r\n          log.reason =\r\n            'Connection has been available but unused for longer than the configured max idle time';\r\n          break;\r\n        case 'error':\r\n          log.reason = 'An error occurred while using the connection';\r\n          if (logObject.error) {\r\n            log.error = logObject.error;\r\n          }\r\n          break;\r\n        case 'poolClosed':\r\n          log.reason = 'Connection pool was closed';\r\n          break;\r\n        default:\r\n          log.reason = `Unknown close reason: ${logObject.reason}`;\r\n      }\r\n      return log;\r\n    case CONNECTION_CHECK_OUT_STARTED:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection checkout started';\r\n      return log;\r\n    case CONNECTION_CHECK_OUT_FAILED:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection checkout failed';\r\n      switch (logObject.reason) {\r\n        case 'poolClosed':\r\n          log.reason = 'Connection pool was closed';\r\n          break;\r\n        case 'timeout':\r\n          log.reason = 'Wait queue timeout elapsed without a connection becoming available';\r\n          break;\r\n        case 'connectionError':\r\n          log.reason = 'An error occurred while trying to establish a new connection';\r\n          if (logObject.error) {\r\n            log.error = logObject.error;\r\n          }\r\n          break;\r\n        default:\r\n          log.reason = `Unknown close reason: ${logObject.reason}`;\r\n      }\r\n      return log;\r\n    case CONNECTION_CHECKED_OUT:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection checked out';\r\n      log.driverConnectionId = logObject.connectionId;\r\n      return log;\r\n    case CONNECTION_CHECKED_IN:\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Connection checked in';\r\n      log.driverConnectionId = logObject.connectionId;\r\n      return log;\r\n    case SERVER_OPENING:\r\n      log = attachSDAMFields(log, logObject);\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Starting server monitoring';\r\n      return log;\r\n    case SERVER_CLOSED:\r\n      log = attachSDAMFields(log, logObject);\r\n      log = attachConnectionFields(log, logObject);\r\n      log.message = 'Stopped server monitoring';\r\n      return log;\r\n    case SERVER_HEARTBEAT_STARTED:\r\n      log = attachSDAMFields(log, logObject);\r\n      log = attachServerHeartbeatFields(log, logObject);\r\n      log.message = 'Server heartbeat started';\r\n      return log;\r\n    case SERVER_HEARTBEAT_SUCCEEDED:\r\n      log = attachSDAMFields(log, logObject);\r\n      log = attachServerHeartbeatFields(log, logObject);\r\n      log.message = 'Server heartbeat succeeded';\r\n      log.durationMS = logObject.duration;\r\n      log.serverConnectionId = logObject.serverConnectionId;\r\n      log.reply = stringifyWithMaxLen(logObject.reply, maxDocumentLength, { relaxed: true });\r\n      return log;\r\n    case SERVER_HEARTBEAT_FAILED:\r\n      log = attachSDAMFields(log, logObject);\r\n      log = attachServerHeartbeatFields(log, logObject);\r\n      log.message = 'Server heartbeat failed';\r\n      log.durationMS = logObject.duration;\r\n      log.failure = logObject.failure?.message;\r\n      return log;\r\n    case TOPOLOGY_OPENING:\r\n      log = attachSDAMFields(log, logObject);\r\n      log.message = 'Starting topology monitoring';\r\n      return log;\r\n    case TOPOLOGY_CLOSED:\r\n      log = attachSDAMFields(log, logObject);\r\n      log.message = 'Stopped topology monitoring';\r\n      return log;\r\n    case TOPOLOGY_DESCRIPTION_CHANGED:\r\n      log = attachSDAMFields(log, logObject);\r\n      log.message = 'Topology description changed';\r\n      log.previousDescription = log.reply = stringifyWithMaxLen(\r\n        logObject.previousDescription,\r\n        maxDocumentLength\r\n      );\r\n      log.newDescription = log.reply = stringifyWithMaxLen(\r\n        logObject.newDescription,\r\n        maxDocumentLength\r\n      );\r\n      return log;\r\n    default:\r\n      for (const [key, value] of Object.entries(logObject)) {\r\n        if (value != null) log[key] = value;\r\n      }\r\n  }\r\n  return log;\r\n}\r\n\r\n/** @internal */\r\nexport class MongoLogger {\r\n  componentSeverities: Record<MongoLoggableComponent, SeverityLevel>;\r\n  maxDocumentLength: number;\r\n  logDestination: MongoDBLogWritable;\r\n  logDestinationIsStdErr: boolean;\r\n  pendingLog: PromiseLike<unknown> | unknown = null;\r\n  private severities: Record<MongoLoggableComponent, Record<SeverityLevel, boolean>>;\r\n\r\n  /**\r\n   * This method should be used when logging errors that do not have a public driver API for\r\n   * reporting errors.\r\n   */\r\n  error = this.log.bind(this, 'error');\r\n  /**\r\n   * This method should be used to log situations where undesirable application behaviour might\r\n   * occur. For example, failing to end sessions on `MongoClient.close`.\r\n   */\r\n  warn = this.log.bind(this, 'warn');\r\n  /**\r\n   * This method should be used to report high-level information about normal driver behaviour.\r\n   * For example, the creation of a `MongoClient`.\r\n   */\r\n  info = this.log.bind(this, 'info');\r\n  /**\r\n   * This method should be used to report information that would be helpful when debugging an\r\n   * application. For example, a command starting, succeeding or failing.\r\n   */\r\n  debug = this.log.bind(this, 'debug');\r\n  /**\r\n   * This method should be used to report fine-grained details related to logic flow. For example,\r\n   * entering and exiting a function body.\r\n   */\r\n  trace = this.log.bind(this, 'trace');\r\n\r\n  constructor(options: MongoLoggerOptions) {\r\n    this.componentSeverities = options.componentSeverities;\r\n    this.maxDocumentLength = options.maxDocumentLength;\r\n    this.logDestination = options.logDestination;\r\n    this.logDestinationIsStdErr = options.logDestinationIsStdErr;\r\n    this.severities = this.createLoggingSeverities();\r\n  }\r\n\r\n  createLoggingSeverities(): Record<MongoLoggableComponent, Record<SeverityLevel, boolean>> {\r\n    const severities = Object();\r\n    for (const component of Object.values(MongoLoggableComponent)) {\r\n      severities[component] = {};\r\n      for (const severityLevel of Object.values(SeverityLevel)) {\r\n        severities[component][severityLevel] =\r\n          compareSeverity(severityLevel, this.componentSeverities[component]) <= 0;\r\n      }\r\n    }\r\n    return severities;\r\n  }\r\n\r\n  turnOffSeverities() {\r\n    for (const component of Object.values(MongoLoggableComponent)) {\r\n      this.componentSeverities[component] = SeverityLevel.OFF;\r\n      for (const severityLevel of Object.values(SeverityLevel)) {\r\n        this.severities[component][severityLevel] = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  private logWriteFailureHandler(error: Error) {\r\n    if (this.logDestinationIsStdErr) {\r\n      this.turnOffSeverities();\r\n      this.clearPendingLog();\r\n      return;\r\n    }\r\n    this.logDestination = createStdioLogger(process.stderr);\r\n    this.logDestinationIsStdErr = true;\r\n    this.clearPendingLog();\r\n    this.error(MongoLoggableComponent.CLIENT, {\r\n      toLog: function () {\r\n        return {\r\n          message: 'User input for mongodbLogPath is now invalid. Logging is halted.',\r\n          error: error.message\r\n        };\r\n      }\r\n    });\r\n    this.turnOffSeverities();\r\n    this.clearPendingLog();\r\n  }\r\n\r\n  private clearPendingLog() {\r\n    this.pendingLog = null;\r\n  }\r\n\r\n  willLog(component: MongoLoggableComponent, severity: SeverityLevel): boolean {\r\n    if (severity === SeverityLevel.OFF) return false;\r\n    return this.severities[component][severity];\r\n  }\r\n\r\n  private log(\r\n    severity: SeverityLevel,\r\n    component: MongoLoggableComponent,\r\n    message: Loggable | string\r\n  ): void {\r\n    if (!this.willLog(component, severity)) return;\r\n\r\n    let logMessage: Log = { t: new Date(), c: component, s: severity };\r\n    if (typeof message === 'string') {\r\n      logMessage.message = message;\r\n    } else if (typeof message === 'object') {\r\n      if (isLogConvertible(message)) {\r\n        logMessage = { ...logMessage, ...message.toLog() };\r\n      } else {\r\n        logMessage = { ...logMessage, ...defaultLogTransform(message, this.maxDocumentLength) };\r\n      }\r\n    }\r\n\r\n    if (isPromiseLike(this.pendingLog)) {\r\n      this.pendingLog = this.pendingLog\r\n        .then(() => this.logDestination.write(logMessage))\r\n        .then(this.clearPendingLog.bind(this), this.logWriteFailureHandler.bind(this));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const logResult = this.logDestination.write(logMessage);\r\n      if (isPromiseLike(logResult)) {\r\n        this.pendingLog = logResult.then(\r\n          this.clearPendingLog.bind(this),\r\n          this.logWriteFailureHandler.bind(this)\r\n        );\r\n      }\r\n    } catch (error) {\r\n      this.logWriteFailureHandler(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Merges options set through environment variables and the MongoClient, preferring environment\r\n   * variables when both are set, and substituting defaults for values not set. Options set in\r\n   * constructor take precedence over both environment variables and MongoClient options.\r\n   *\r\n   * @remarks\r\n   * When parsing component severity levels, invalid values are treated as unset and replaced with\r\n   * the default severity.\r\n   *\r\n   * @param envOptions - options set for the logger from the environment\r\n   * @param clientOptions - options set for the logger in the MongoClient options\r\n   * @returns a MongoLoggerOptions object to be used when instantiating a new MongoLogger\r\n   */\r\n  static resolveOptions(\r\n    envOptions: MongoLoggerEnvOptions,\r\n    clientOptions: MongoLoggerMongoClientOptions\r\n  ): MongoLoggerOptions {\r\n    // client options take precedence over env options\r\n    const resolvedLogPath = resolveLogPath(envOptions, clientOptions);\r\n    const combinedOptions = {\r\n      ...envOptions,\r\n      ...clientOptions,\r\n      mongodbLogPath: resolvedLogPath.mongodbLogPath,\r\n      mongodbLogPathIsStdErr: resolvedLogPath.mongodbLogPathIsStdErr\r\n    };\r\n    const defaultSeverity = resolveSeverityConfiguration(\r\n      combinedOptions.mongodbLogComponentSeverities?.default,\r\n      combinedOptions.MONGODB_LOG_ALL,\r\n      SeverityLevel.OFF\r\n    );\r\n\r\n    return {\r\n      componentSeverities: {\r\n        command: resolveSeverityConfiguration(\r\n          combinedOptions.mongodbLogComponentSeverities?.command,\r\n          combinedOptions.MONGODB_LOG_COMMAND,\r\n          defaultSeverity\r\n        ),\r\n        topology: resolveSeverityConfiguration(\r\n          combinedOptions.mongodbLogComponentSeverities?.topology,\r\n          combinedOptions.MONGODB_LOG_TOPOLOGY,\r\n          defaultSeverity\r\n        ),\r\n        serverSelection: resolveSeverityConfiguration(\r\n          combinedOptions.mongodbLogComponentSeverities?.serverSelection,\r\n          combinedOptions.MONGODB_LOG_SERVER_SELECTION,\r\n          defaultSeverity\r\n        ),\r\n        connection: resolveSeverityConfiguration(\r\n          combinedOptions.mongodbLogComponentSeverities?.connection,\r\n          combinedOptions.MONGODB_LOG_CONNECTION,\r\n          defaultSeverity\r\n        ),\r\n        client: resolveSeverityConfiguration(\r\n          combinedOptions.mongodbLogComponentSeverities?.client,\r\n          combinedOptions.MONGODB_LOG_CLIENT,\r\n          defaultSeverity\r\n        ),\r\n        default: defaultSeverity\r\n      },\r\n      maxDocumentLength:\r\n        combinedOptions.mongodbLogMaxDocumentLength ??\r\n        parseUnsignedInteger(combinedOptions.MONGODB_LOG_MAX_DOCUMENT_LENGTH) ??\r\n        1000,\r\n      logDestination: combinedOptions.mongodbLogPath,\r\n      logDestinationIsStdErr: combinedOptions.mongodbLogPathIsStdErr\r\n    };\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}